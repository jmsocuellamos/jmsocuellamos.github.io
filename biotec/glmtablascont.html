<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Unidad 15 GLM para tablas de contingencia | Modelos Estadísticos</title>
<meta name="description" content="Un tabla de contingencia se usa para estudiar una tabla de clasificación de un conjunto de factores donde se recogen el número de casos de cada una de las combinaciones de dichos factores. En este...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Unidad 15 GLM para tablas de contingencia | Modelos Estadísticos">
<meta property="og:type" content="book">
<meta property="og:description" content="Un tabla de contingencia se usa para estudiar una tabla de clasificación de un conjunto de factores donde se recogen el número de casos de cada una de las combinaciones de dichos factores. En este...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unidad 15 GLM para tablas de contingencia | Modelos Estadísticos">
<meta name="twitter:description" content="Un tabla de contingencia se usa para estudiar una tabla de clasificación de un conjunto de factores donde se recogen el número de casos de cada una de las combinaciones de dichos factores. En este...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Modelos Estadísticos</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bienvenidos</a></li>
<li><a class="" href="introlibro.html"><span class="header-section-number">1</span> Comenzamos</a></li>
<li><a class="" href="aed.html"><span class="header-section-number">2</span> Análisis exploratorio de datos</a></li>
<li><a class="" href="prob.html"><span class="header-section-number">3</span> Probabilidad</a></li>
<li><a class="" href="inferencia-b%C3%A1sica.html"><span class="header-section-number">4</span> Inferencia básica</a></li>
<li><a class="" href="modelstats.html"><span class="header-section-number">5</span> Modelos estadísticos</a></li>
<li><a class="" href="rls.html"><span class="header-section-number">6</span> Regresión Lineal Simple (RLS)</a></li>
<li><a class="" href="rlm.html"><span class="header-section-number">7</span> Regresión Lineal Múltiple y Polinómica</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">8</span> Modelos ANOVA</a></li>
<li><a class="" href="ancova.html"><span class="header-section-number">9</span> Modelos ANCOVA</a></li>
<li><a class="" href="smooth.html"><span class="header-section-number">10</span> Modelos aditivos lineales</a></li>
<li><a class="" href="mmixed.html"><span class="header-section-number">11</span> Modelos Lineales Mixtos</a></li>
<li><a class="" href="glm.html"><span class="header-section-number">12</span> Modelos Lineales Generalizados</a></li>
<li><a class="" href="glmbinomial.html"><span class="header-section-number">13</span> GLM respuesta binomial</a></li>
<li><a class="" href="glmpoisson.html"><span class="header-section-number">14</span> GLM Poisson</a></li>
<li><a class="active" href="glmtablascont.html"><span class="header-section-number">15</span> GLM para tablas de contingencia</a></li>
<li><a class="" href="glmsuperv.html"><span class="header-section-number">16</span> GLM para datos de supervivencia</a></li>
<li><a class="" href="referencias.html">Referencias</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="glmtablascont" class="section level1" number="15">
<h1>
<span class="header-section-number">Unidad 15</span> GLM para tablas de contingencia<a class="anchor" aria-label="anchor" href="#glmtablascont"><i class="fas fa-link"></i></a>
</h1>
<p>Un tabla de contingencia se usa para estudiar una tabla de clasificación de un conjunto de factores donde se recogen el número de casos de cada una de las combinaciones de dichos factores.</p>
<p>En este tipo de modelos las variables respuestas y predictoras son todas categóricas, medidas en una escala nominal u ordinal, aunque como veremos las construcción de este tipo de modelos se centran en estudiar las frecuencias de ocurrencia de cada combinación de los factores. El objetivo básico en el análisis de tablas de contingencia es estudiar si existe alguna relación/asociación entre los factores de clasificación considerados. posteriormente, si dicha relación existe, habrá que describir cómo es para tratar de predecirla. Para cuantificar el grado de asociación entre los factores de clasificación, los modelos log-lineales proporcionarán predicciones de las frecuencias observadas en las celdas y las probabilidades asociadas, en función de dichos factores y la interacción entre ellos.</p>
<p>Para el análisis de estipo de datos es necesario que los datos vengan en un formato específico de forma que cada fila representa una combinación de los factores presentes en la tabla de contingencia y debe haber una columna que recoja los conteos o frecuencias de esa combinación. En ocasiones los datos deben ser trasnformados a partir de la tabla de contingencia para conseguir el fromato adecaudo para el análisis. En este último caso utilizaremos la función <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> que nosa permite modificar de forma sencilla la configuración del banco de datos.</p>
<p>Como ocurría en los modelos de regresión de Poisson, en el caso de trabajar con factores ordinales se debderna considerar sus versiones numéwricas utilizando el método de codificación presentado en esa unidad.</p>
<div id="bancos-de-datos-6" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Bancos de datos<a class="anchor" aria-label="anchor" href="#bancos-de-datos-6"><i class="fas fa-link"></i></a>
</h2>
<p>A continuación se presentan diferentes ejemplos de tablas de contingencia que iremos analizando a lo largo de la unidad. Realizamos una primera aproximación gráfica a la tabla de contingencia obtenida.</p>
<div id="melanoma" class="section level3" number="15.1.1">
<h3>
<span class="header-section-number">15.1.1</span> Melanoma<a class="anchor" aria-label="anchor" href="#melanoma"><i class="fas fa-link"></i></a>
</h3>
<p>Los datos siguientes provienen de un estudio de pacientes con una forma de cáncer de piel llamado melanoma maligno. En una muestra de 400 pacientes se recogió información sobre la localización del tumor y su tipo histológico. Los datos son el número de pacientes (<code>frecuency</code>) en cada combinación de tipo de tumor (<code>type</code>) y localización (<code>site</code>). El objetivo básico del análisis es investigar si determinados tipos de tumor están asociados a ciertas localizaciones. La tabla de conteos o contingencia recogida es:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Tipo / Localización</th>
<th>Cabeza-Cuello</th>
<th>Tronco</th>
<th>Extremidades</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Melanoma de Hutchinson</td>
<td>22</td>
<td>2</td>
<td>10</td>
</tr>
<tr class="even">
<td>Melanoma Superficial</td>
<td>16</td>
<td>54</td>
<td>115</td>
</tr>
<tr class="odd">
<td>Nodular</td>
<td>19</td>
<td>33</td>
<td>73</td>
</tr>
<tr class="even">
<td>Indeterminado</td>
<td>11</td>
<td>17</td>
<td>28</td>
</tr>
</tbody>
</table></div>
<p>EL código para cargar estos datos se presenta a continaución. En este caso cada línea representa una combinación de factores. También representamos los datos:</p>
<div class="sourceCode" id="cb814"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Carga de datos</span>
<span class="va">Melanoma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://goo.gl/yeCXsv"</span>, col_types <span class="op">=</span> <span class="st">"cci"</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Melanoma</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">site</span>, y <span class="op">=</span> <span class="va">frequency</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_identity.html">stat_identity</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"bar"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont001-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>Podemos ver claramente que hay ciertos tumores que tienen una mayor predisposición a aparecer en una parte del cuerpo que en otra.</p>
</div>
<div id="gripe" class="section level3" number="15.1.2">
<h3>
<span class="header-section-number">15.1.2</span> Gripe<a class="anchor" aria-label="anchor" href="#gripe"><i class="fas fa-link"></i></a>
</h3>
<p>En un estudio prospectivo sobre una nueva vacuna para la gripe, los pacientes fueron asignados aleatoriamente a dos grupos. A los pacientes de uno de los grupos se les trató con la nueva vacuna y a los otros se les dio un placebo salino. Las respuestas fueron los niveles de anticuerpos inhibidores de hemoglutinina (HIA) encontrados en la sangre seis semanas después de la vacunación. Los datos se encuentran en el banco de datos siguiente. El objetivo del estudio es investigar el efecto de la nueva vacuna, esto es, comprobar si el hecho de dar placebo o vacuna provoca diferente respuesta HIA. Así, la variable HIA es la variable a explicar (<code>response</code>) en función del tipo de tratamiento (<code>treatment</code>) que ha recibido el paciente y las frecuencias de las celdas (<code>frequency</code>).</p>
<p>La tabla de contingencia obtenida es:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Tratamiento / Respuesta</th>
<th>Pequeño</th>
<th>Moderado</th>
<th>Grande</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Placebo</td>
<td>25</td>
<td>8</td>
<td>5</td>
</tr>
<tr class="even">
<td>Vacuna</td>
<td>6</td>
<td>18</td>
<td>11</td>
</tr>
</tbody>
</table></div>
<p>Podemos cargar los datos y representarlos gráficamente</p>
<div class="sourceCode" id="cb815"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Lectura de datos</span>
<span class="va">Gripe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://goo.gl/jPcz7x"</span>, col_types <span class="op">=</span> <span class="st">"cci"</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Gripe</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">frequency</span>, fill <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_identity.html">stat_identity</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"bar"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont002-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>Se puede ver un comportamiento distinto entre el placebo y el tratamiento.</p>
</div>
<div id="aspirina" class="section level3" number="15.1.3">
<h3>
<span class="header-section-number">15.1.3</span> Aspirina<a class="anchor" aria-label="anchor" href="#aspirina"><i class="fas fa-link"></i></a>
</h3>
<p>En un estudio retrospectivo de casos-controles, se reunió a un grupo de pacientes con úlcera y se buscó a otro grupo de individuos de similares características a los anteriores en edad, sexo y estatus socio económico, sobre los que no se sabía que tuvieran úlcera péptica. Los pacientes con úlcera fueron clasificados de acuerdo a la localización de la úlcera: gástrica o duodenal. Se les preguntó a todos si consumían aspirina. El objetivo del análisis es averiguar si existe alguna relación entre el consumo de aspirina y la existencia de algún tipo de úlcera. Si existe tal asociación, querríamos comprobar si el consumo de aspirina (<code>aspirina</code>) es más habitual en los pacientes con úlcera gástrica que en los de úlcera duodenal (<code>locali</code>). Interesa predecir el consumo de aspirina (variable a explicar) en función de si un individuo tiene úlcera o no (<code>ulcera</code>). y si la tiene, de qué tipo es. La variable <code>frecuencia</code> contiene los conteos de las combinaciones de tratamientos.</p>
<p>La tabla de contingencia obtenida es:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Tipo Úlcera</th>
<th>Úlcera / Consumo de aspirina</th>
<th>No</th>
<th>Si</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Gástrica</td>
<td>Si</td>
<td>39</td>
<td>25</td>
</tr>
<tr class="even">
<td></td>
<td>No</td>
<td>62</td>
<td>6</td>
</tr>
<tr class="odd">
<td>Duodenal</td>
<td>Si</td>
<td>49</td>
<td>8</td>
</tr>
<tr class="even">
<td></td>
<td>No</td>
<td>53</td>
<td>8</td>
</tr>
</tbody>
</table></div>
<p>Podemos cargar los datos y representarlos gráficamente</p>
<div class="sourceCode" id="cb816"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Carga de datos</span>
<span class="va">locali</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">8</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Gástrica"</span>, <span class="st">"Duodenal"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ulcera</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">8</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Si"</span>, <span class="st">"No"</span><span class="op">)</span><span class="op">)</span>
<span class="va">aspirina</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"No"</span>, <span class="st">"Si"</span><span class="op">)</span><span class="op">)</span>
<span class="va">frecuencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">39</span>, <span class="fl">62</span>, <span class="fl">49</span>, <span class="fl">53</span>, <span class="fl">25</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span>
<span class="va">Aspirina</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">locali</span>, <span class="va">ulcera</span>, <span class="va">aspirina</span>, <span class="va">frecuencia</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Aspirina</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">aspirina</span>, y <span class="op">=</span> <span class="va">frecuencia</span>, fill <span class="op">=</span> <span class="va">locali</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_identity.html">stat_identity</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"bar"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">ulcera</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>xlab <span class="op">=</span><span class="st">"Consumo de aspirina"</span>, 
       title <span class="op">=</span> <span class="st">"Desarrollo de úlcera"</span>, fill <span class="op">=</span> <span class="st">"Localización"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont003-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>De nuevo se observan comportamientos distintos para la combinación de los factores considerados.</p>
</div>
<div id="aspiraciones" class="section level3" number="15.1.4">
<h3>
<span class="header-section-number">15.1.4</span> Aspiraciones<a class="anchor" aria-label="anchor" href="#aspiraciones"><i class="fas fa-link"></i></a>
</h3>
<p>En la tabla se muestran una parte de los resultados de un estudio en los Estados Unidos con el que se pretendía investigar el grado de asociación entre las aspiraciones de los estudiantes de bachillerato por proseguir con estudios universitarios (<code>aspiraciones</code>) y su entorno social, medido en términos del estatus socio-económico de su familia (<code>estatus</code>) y el hecho de que recibieron motivación en su familia para continuar estudiando (<code>motivacion</code>). La variable <code>frecuencia</code> contiene los conteos para todas las combinaciones. La tabla de contingencia original es:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Estatus</th>
<th>Motivación familiar / Aspiraciones Universitarias</th>
<th>No</th>
<th>Si</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Baja</td>
<td>Baja</td>
<td>749</td>
<td>35</td>
</tr>
<tr class="even">
<td></td>
<td>Alta</td>
<td>233</td>
<td>133</td>
</tr>
<tr class="odd">
<td>Media-Baja</td>
<td>Baja</td>
<td>627</td>
<td>38</td>
</tr>
<tr class="even">
<td></td>
<td>Alta</td>
<td>330</td>
<td>303</td>
</tr>
<tr class="odd">
<td>Media-Alta</td>
<td>Baja</td>
<td>420</td>
<td>37</td>
</tr>
<tr class="even">
<td></td>
<td>Alta</td>
<td>374</td>
<td>467</td>
</tr>
<tr class="odd">
<td>Alta</td>
<td>Baja</td>
<td>153</td>
<td>26</td>
</tr>
<tr class="even">
<td></td>
<td>Alta</td>
<td>266</td>
<td>800</td>
</tr>
</tbody>
</table></div>
<p>Dado que Estatus y Motivación personal son factores ordinales se debe considerar su codificación como variables numéricas. A continuación se presenta la lectura del banco de datos y su representación gráfica.</p>
<div class="sourceCode" id="cb817"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estatus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">16</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Baja"</span>, <span class="st">"Media-Baja"</span>,
                                   <span class="st">"Media-Alta"</span>, <span class="st">"Alta"</span><span class="op">)</span><span class="op">)</span>
<span class="va">motivacion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">16</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Baja"</span>, <span class="st">"Alta"</span><span class="op">)</span><span class="op">)</span>
<span class="va">aspiraciones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span>, <span class="fl">16</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"No"</span>, <span class="st">"Si"</span><span class="op">)</span><span class="op">)</span>
<span class="va">frecuencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">749</span>, <span class="fl">233</span>, <span class="fl">627</span>, <span class="fl">330</span>, <span class="fl">420</span>, <span class="fl">374</span>, <span class="fl">153</span>, <span class="fl">266</span>, 
                <span class="fl">35</span>, <span class="fl">133</span>, <span class="fl">38</span>, <span class="fl">303</span>, <span class="fl">37</span>, <span class="fl">467</span>, <span class="fl">26</span>, <span class="fl">800</span><span class="op">)</span>
<span class="va">Aspiraciones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">estatus</span>, <span class="va">motivacion</span>, <span class="va">aspiraciones</span>, <span class="va">frecuencia</span><span class="op">)</span>
<span class="co"># Código numérico para factores ordinales</span>
<span class="va">Aspiraciones</span> <span class="op">&lt;-</span> <span class="va">Aspiraciones</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>estatus.num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>, 
         motivacion.num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Represenatción gráfica</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Aspiraciones</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">aspiraciones</span>, y <span class="op">=</span> <span class="va">frecuencia</span>, fill <span class="op">=</span> <span class="va">motivacion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_identity.html">stat_identity</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"bar"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">estatus</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>xlab <span class="op">=</span><span class="st">"Conusmo de aspirina"</span>, 
    title <span class="op">=</span> <span class="st">"Estatus social"</span>, fill <span class="op">=</span> <span class="st">"Motivación"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont004-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Qué podemos comentar del gráfico obtenido?</p>
</div>
<div id="contraceptivos" class="section level3" number="15.1.5">
<h3>
<span class="header-section-number">15.1.5</span> Contraceptivos<a class="anchor" aria-label="anchor" href="#contraceptivos"><i class="fas fa-link"></i></a>
</h3>
<p>En la tabla aparecen los datos de un estudio sobre distintos usos contraceptivos en diferentes grupos generacionales. Entendiendo la variable método contraceptivo (<code>metodo</code>) como variable respuesta y la variable edad (<code>edad</code>) como predictiva, una cuestión de interés puede ser predecir el uso anticonceptivo de una mujer en función de su edad. La variable <code>frecuencia</code> contiene los conteos para todas las combinaciones.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Edad / Método contraceptivo</th>
<th>Esterilización</th>
<th>Otros</th>
<th>Ninguno</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>15-19</td>
<td>3</td>
<td>61</td>
<td>232</td>
</tr>
<tr class="even">
<td>20-24</td>
<td>80</td>
<td>137</td>
<td>400</td>
</tr>
<tr class="odd">
<td>25-29</td>
<td>216</td>
<td>131</td>
<td>301</td>
</tr>
<tr class="even">
<td>30-34</td>
<td>268</td>
<td>76</td>
<td>203</td>
</tr>
<tr class="odd">
<td>35-39</td>
<td>197</td>
<td>50</td>
<td>188</td>
</tr>
<tr class="even">
<td>40-44</td>
<td>150</td>
<td>24</td>
<td>164</td>
</tr>
<tr class="odd">
<td>45-49</td>
<td>91</td>
<td>10</td>
<td>183</td>
</tr>
</tbody>
</table></div>
<p>El código de lectura de datos (incluyendo la codificación del factor ordinal como el punto medio del intervalo) y el gráfico se muestran a continuación:</p>
<div class="sourceCode" id="cb818"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">edad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">1</span>, <span class="fl">21</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"15-19"</span>, <span class="st">"20-24"</span>, <span class="st">"25-29"</span>, 
                                <span class="st">"30-34"</span>, <span class="st">"35-39"</span>, <span class="st">"40-44"</span>, <span class="st">"45-49"</span><span class="op">)</span><span class="op">)</span>
<span class="va">metodo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">21</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="st">"Esterilización"</span>, <span class="st">"Otros"</span>, <span class="st">"Ninguno"</span><span class="op">)</span><span class="op">)</span>
<span class="va">frecuencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">80</span>, <span class="fl">216</span>, <span class="fl">268</span>, <span class="fl">197</span>, <span class="fl">150</span>, <span class="fl">91</span>, <span class="fl">61</span>, <span class="fl">137</span>, <span class="fl">131</span>, <span class="fl">76</span>, 
                <span class="fl">50</span>, <span class="fl">24</span>, <span class="fl">10</span>, <span class="fl">232</span>, <span class="fl">400</span>, <span class="fl">301</span>, <span class="fl">203</span>, <span class="fl">188</span>, <span class="fl">164</span>, <span class="fl">183</span><span class="op">)</span>
<span class="va">Contraceptivos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edad</span>, <span class="va">metodo</span>, <span class="va">frecuencia</span><span class="op">)</span>
<span class="co"># Código numérico para factor ordinales</span>
<span class="va">Contraceptivos</span> <span class="op">&lt;-</span> <span class="va">Contraceptivos</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>edad.num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">22</span>, <span class="fl">27</span>, <span class="fl">32</span>, <span class="fl">37</span>, <span class="fl">42</span>, <span class="fl">47</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Contraceptivos</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">metodo</span>, y <span class="op">=</span> <span class="va">frecuencia</span>, fill <span class="op">=</span> <span class="va">edad</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_identity.html">stat_identity</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"bar"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont005-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Qué conclusiones podemos obtener de este gráfico?</p>
</div>
<div id="satisfacción-laboral" class="section level3" number="15.1.6">
<h3>
<span class="header-section-number">15.1.6</span> Satisfacción laboral<a class="anchor" aria-label="anchor" href="#satisfacci%C3%B3n-laboral"><i class="fas fa-link"></i></a>
</h3>
<p>Los datos que se presentan corresponden a un estudio en el que se pretendía concluir sobre la relación entre el grado de satisfacción en el trabajo (<code>Estado</code>) y los ingresos percibidos (<code>Ingresos</code>). El objetivo es predecir el grado de satisfacción en el trabajo en función de los ingresos percibidos (en dólares). Construimos la variable <code>frecuencia</code> que contiene los conteos para todas las combinaciones.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Ingresos / Satisfacción</th>
<th>Muy Insatisfecho</th>
<th>Poco Insatisfecho</th>
<th>Moderadamente Satisfecho</th>
<th>Muy Satisfecho</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>&lt; 6000</td>
<td>20</td>
<td>24</td>
<td>80</td>
<td>82</td>
</tr>
<tr class="even">
<td>6000 - 15000</td>
<td>22</td>
<td>38</td>
<td>104</td>
<td>125</td>
</tr>
<tr class="odd">
<td>15000 - 25000</td>
<td>13</td>
<td>28</td>
<td>81</td>
<td>113</td>
</tr>
<tr class="even">
<td>&gt; 25000</td>
<td>7</td>
<td>18</td>
<td>54</td>
<td>92</td>
</tr>
</tbody>
</table></div>
<p>Cargamos los datos que vienen en formato de tabla, con lo que es necesario transformarlos adecuadamente. También se calculan las variables numéricas asociadas con los factores ordinales.</p>
<div class="sourceCode" id="cb819"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Satisfaccion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://goo.gl/5T0nh0"</span>, col_types <span class="op">=</span> <span class="st">"ciiii"</span><span class="op">)</span>
<span class="co"># Construimos la tabla donde cada fila recoge la frecuencia observada para combinación de las variables</span>
<span class="va">Satisfaccion</span> <span class="op">&lt;-</span> <span class="va">Satisfaccion</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">`Muy insatisfecho`</span>, <span class="va">`Poco insatisfecho`</span>,
         <span class="va">`Moderadamente satisfecho`</span>, <span class="va">`Muy satisfecho`</span>,
         key <span class="op">=</span> <span class="st">"Estado"</span>, value <span class="op">=</span> <span class="va">frecuencia</span><span class="op">)</span>
<span class="co"># Código numérico para factores ordinales</span>
<span class="va">Satisfaccion</span> <span class="op">&lt;-</span> <span class="va">Satisfaccion</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Ingresos.num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>, 
         Estado.num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="co"># Creamos un vector con el orden predefinido</span>
<span class="va">ords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 6000"</span>, <span class="st">"6000 - 15000"</span>, <span class="st">"15000 - 25000"</span>, <span class="st">"&gt; 25000"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Satisfaccion</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Ingresos</span>, y <span class="op">=</span> <span class="va">frecuencia</span>, fill <span class="op">=</span> <span class="va">Estado</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_identity.html">stat_identity</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"bar"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">ords</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont006-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Qué conclusiones podemos obtener de este gráfico?</p>
</div>
</div>
<div id="modelos-log-lineales" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Modelos Log-Lineales<a class="anchor" aria-label="anchor" href="#modelos-log-lineales"><i class="fas fa-link"></i></a>
</h2>
<p>Las cuestiones básicas de interés en el análisis de tablas de contingencia son detectar asociación entre los factores de clasificación y predecir las frecuencias medias observadas. Dichas cuestiones se pueden resolver a partir de la modelización log-lineal de las frecuencias esperadas.
Consideramos, para presentar estos modelos, únicamente dos vías de clasificación, F1 y F2. Si los factores se consideran independientes el número de individuos que esperamos clasificar en la celda <span class="math inline">\((i, j)\)</span> (nivel <span class="math inline">\(i\)</span> de F1 y nivel <span class="math inline">\(j\)</span> de F2) se puede calcular a través del producto de los sucesos independientes “número esperado de individuos clasificados en el nivel i de F1”, <span class="math inline">\(\mu_{i+}\)</span>, y “número esperado de individuos clasificados en el nivel j de F2”, <span class="math inline">\(\mu_{+j}\)</span> esto es,</p>
<p><span class="math display">\[E(Y_{ij}) = \mu_{ij} = \mu_{i+}*\mu_{+j}\]</span></p>
<p>El efecto multiplicativo de los factores para predecir la frecuencia observada da lugar, de modo natural, a modelos logarítmicos aditivos (modelos log-lineales) de la forma:</p>
<p><span class="math display">\[log(E(Y_{ij})) = \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij}\]</span></p>
<p>donde <span class="math inline">\(\alpha_i\)</span> representa el efecto principal del factor fila F1 , <span class="math inline">\(\beta_j\)</span> el correspondiente al factor columna F2 y el <span class="math inline">\((\alpha\beta)_{ij}\)</span> efecto de interacción entre ambos. Este modelo se denomina modelo saturado, ya que tiene tantos parámetros como celdas estamos considerando en la combinación de los factores, y tiene poco interés desde el punto de vista estadístico ya que cada parámetro del modelo se estima con un único valor en la muestra de datos. Contrastar independencia versus asociación será equivalente a contrastar interacción nula versus no nula en el modelo log-lineal, es decir debemos estudiar los modelos:</p>
<ul>
<li>El modelo saturado dado por <span class="math inline">\(Frecuencias \sim F1 * F2\)</span>
</li>
<li>El modelo sin interacción dado por <span class="math inline">\(Frecuencias \sim F1 + F2\)</span>
</li>
</ul>
<p>dados por las expresiones</p>
<p><span class="math display">\[\begin{array}{ll}
M_0: log(E(Y_{ij})) &amp;= \mu + \alpha_i + \beta_j\\ 
M_1: log(E(Y_{ij})) &amp;= \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij}\\ 
\end{array}\]</span></p>
<p>En la práctica para contrastar independencia ajustamos un modelo con únicamente los efectos principales y valoramos la bondad del ajuste conseguido mediante el test <span class="math inline">\(\chi^2\)</span>. En conclusión, reconocer asociación entre los factores de clasificación de una tabla de contingencia es equivalente a rechazar interacción nula entre ellos en el modelo log-lineal con el que se predicen las frecuencias observadas en las celdas.</p>
<p>Cuando consideramos la tabla de contingencia asociada con tres factores el modelo saturado vendrá dado por:</p>
<p><span class="math display">\[Frecuencias \sim F1 + F2 + F3 + F1:F2 + F1:F3 + F2:F3 + F1:F2:F3\]</span>
donde el efecto de interacción triple <span class="math inline">\(F1:F2:F3\)</span> nos permite estudiar si existe asociación entre los tres factores conjuntamente. En caso de que el contraste de bondad de ajuste del modelo reducido</p>
<p><span class="math display">\[M_0: Frecuencias \sim F1 + F2 + F3 + F1:F2 + F1:F3 + F2:F3\]</span>
no resulte significativo, podremos abordar el estudio de las interacciones dobles de la siguiente forma:</p>
<ul>
<li>la interacción <span class="math inline">\(F1:F2\)</span> nos permite estudiar la asociación entre ambos factores dado F3</li>
<li>la interacción <span class="math inline">\(F1:F3\)</span> nos permite estudiar la asociación entre ambos factores dado F2</li>
<li>la interacción <span class="math inline">\(F2:F3\)</span> nos permite estudiar la asociación entre ambos factores dado F1</li>
</ul>
<p>Por tanto, debemos estudiar la bondad de ajuste de los modelos
<span class="math display">\[\begin{array}{ll}
M_1:&amp; Frecuencias \sim F1 + F2 + F3 + F1:F3 + F2:F3\\ 
M_2:&amp; Frecuencias \sim F1 + F2 + F3 + F1:F2 + F2:F3\\
M_3:&amp; Frecuencias \sim F1 + F2 + F3 + F1:F2 + F1:F3\\
\end{array}\]</span></p>
<p>para detectar las posibles asociaciones. En la pra´ctica siempre se fija un factor como varaible respuesta y los otros dos como predictoras, de forma que, si el factor F1 actúa como respuesta y los otros dos factores como predictoras, el modelo M3 no tiene sentido práctico, ya que en realidad nuestro interés radica en la asociación entre respuesta y predictoras.</p>
<p>Así podemos seguir aumentando el número de factores en el modelo y estudiando las posibles asociaciones entre ellos. Se trata pues de un procedimiento de comparación de efectos o modelos de tipo manual y no automático como habíamos hecho en otro tipo de modelos.</p>
<p>Para escribir de forma reducida lo modelos anteriores usamos la siguiente notación (que también nos vale para el ajuste de los modelos en <code>R</code>).
<span class="math display">\[\begin{array}{ll}
M_0:&amp; Frecuencias \sim (F1+F2+F3)^2\\ 
M_1:&amp; Frecuencias \sim F2*F3 + F1 + F1:F3\\ 
M_2:&amp; Frecuencias \sim F2*F3 + F1 + F1:F2\\
M_3:&amp; Frecuencias \sim F1*F3 + F2 + F1:F2\\
\end{array}\]</span></p>
<div id="especificación-en-r" class="section level3" number="15.2.1">
<h3>
<span class="header-section-number">15.2.1</span> Especificación en R<a class="anchor" aria-label="anchor" href="#especificaci%C3%B3n-en-r"><i class="fas fa-link"></i></a>
</h3>
<p>Para el ajuste de estos modelos utilizamos la función <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> con las especificaciones siguientes:</p>
<p><span class="math display">\[glm(modelo, family = poisson(), data_set)\]</span></p>
<p>donde <span class="math inline">\(modelo\)</span> se establece según las notaciones reducidas que hemos presentado tanto para dos como para tres factores.</p>
</div>
<div id="ejemplos-21" class="section level3" number="15.2.2">
<h3>
<span class="header-section-number">15.2.2</span> Ejemplos<a class="anchor" aria-label="anchor" href="#ejemplos-21"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación estudiamos de forma inicial la independencia o dependencia en los ejemplos del inicio. Para el análisis de independencia utilizamos el test <span class="math inline">\(\chi^2\)</span> de bondad de ajuste y concluímos en función del p-valor obtenido.</p>
<div id="melanoma-1" class="section level4" number="15.2.2.1">
<h4>
<span class="header-section-number">15.2.2.1</span> Melanoma<a class="anchor" aria-label="anchor" href="#melanoma-1"><i class="fas fa-link"></i></a>
</h4>
<p>En este caso la pregunta de interés es si ¿existe asociación entre el tipo de tumor y su localización?, que equivale a estudiar si el efecto de interacción entre tipo de tumor y su localización resulta significativo, es decir, estudiar la bondad de ajuste del modelo sin interacción entre ambos.</p>
<div class="sourceCode" id="cb820"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción</span>
<span class="va">fit.melanoma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frequency</span> <span class="op">~</span> <span class="va">type</span> <span class="op">+</span> <span class="va">site</span>, 
                    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                    data <span class="op">=</span> <span class="va">Melanoma</span><span class="op">)</span>
<span class="co"># Bondad del asjute del modelo</span>
<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">fit.melanoma</span><span class="op">$</span><span class="va">deviance</span>, <span class="va">fit.melanoma</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2.050453e-09</code></pre>
<p>Dado que el valor es inferior a 0.05 podemos concluir que hay evidencias estadísticas a favor de la asociación entre los factores tipo de tumor y localización, es decir, determinados tipos de tumor se presentan en ciertas localizaciones con más frecuencia que en otras.</p>
</div>
<div id="aspirina-1" class="section level4" number="15.2.2.2">
<h4>
<span class="header-section-number">15.2.2.2</span> Aspirina<a class="anchor" aria-label="anchor" href="#aspirina-1"><i class="fas fa-link"></i></a>
</h4>
<p>En el estudio se controlaron las variables úlcera y localización. A los pacientes clasificados en cada una de las combinaciones de estas dos variables se les preguntó sobre el consumo de aspirina, que es la variable aleatoria y por tanto la variable a explicar en función de las otras dos. Las cuestiones que nos planteamos son:</p>
<ul>
<li><p>En el grupo gástrico ¿la úlcera está asociada con el consumo de aspirina? ¿y en el grupo duodenal?. Para ambas cuestiones estamos planteando si, dado un grupo especifico (<code>locali</code>), el consumo de aspirina (<code>aspirina</code>) está relacionado con la existencia de úlcera (<code>ulcera</code>). Ambas preguntas se pueden contestar estudiando el efecto de interacción entre el consumo de aspirina y el desarrollo de una úlcera (<code>aspirina:ulcera</code>).</p></li>
<li><p>Si dicha asociación existe, cabe preguntarse si dicha relación es similar en los dos grupos de pacientes.</p></li>
</ul>
<p>En este caso el estudio de la independencia total nos llevaría a analizar un modelo donde eliminamos la interacción de orden tres. Dicho modelo se puede obtener y analizar con:</p>
<div class="sourceCode" id="cb822"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción</span>
<span class="va">fit.aspirina</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="op">(</span><span class="va">locali</span> <span class="op">+</span> <span class="va">ulcera</span> <span class="op">+</span> <span class="va">aspirina</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, 
                    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                    data <span class="op">=</span> <span class="va">Aspirina</span><span class="op">)</span>
<span class="co"># Bondad del asjute del modelo</span>
<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">fit.aspirina</span><span class="op">$</span><span class="va">deviance</span>, <span class="va">fit.aspirina</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.01219027</code></pre>
<p>Dado que el p-valor resulta significativo podemos concluir que existe asociación entre los factores considerados. Pasamos ahora a estudiar cada una de las cuestiones planteadas ahora que sabemos que los factores están relacionados. Para saber si la existencia del desarrollo de una úlcera está asociado con el consumo de aspirina para cada tipo de úlcera, ajustamos un modelo sin la interacción <code>aspirina:ulcera</code></p>
<div class="sourceCode" id="cb824"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción</span>
<span class="va">fit.aspirina</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">locali</span><span class="op">*</span><span class="va">ulcera</span> <span class="op">+</span> <span class="va">aspirina</span> <span class="op">+</span> <span class="va">aspirina</span><span class="op">:</span><span class="va">locali</span>, 
                    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                    data <span class="op">=</span> <span class="va">Aspirina</span><span class="op">)</span>
<span class="co"># Bondad del asjute del modelo</span>
<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">fit.aspirina</span><span class="op">$</span><span class="va">deviance</span>, <span class="va">fit.aspirina</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.000143616</code></pre>
<p>Se rechaza claramente independencia entre el consumo de aspirina y la existencia de úlcera para ambos tipos de úlcera.</p>
<p>Pasamos ahora a la segunda cuestión, es decir, tratamos de averiguar si existe asociación entre el consumo de aspirina y el tipo de úlcera desarrollada. Para ello debemos analizar la interacción entre <code>aspirina:locali</code> cuando sabemos que se ha desarrollado una úlcera</p>
<div class="sourceCode" id="cb826"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción</span>
<span class="va">fit.aspirina</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">locali</span><span class="op">*</span><span class="va">ulcera</span> <span class="op">+</span> <span class="va">aspirina</span> <span class="op">+</span> <span class="va">aspirina</span><span class="op">:</span><span class="va">ulcera</span>, 
                    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                    data <span class="op">=</span> <span class="va">Aspirina</span><span class="op">)</span>
<span class="co"># Bondad del asjute del modelo</span>
<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">fit.aspirina</span><span class="op">$</span><span class="va">deviance</span>, <span class="va">fit.aspirina</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.005147627</code></pre>
<p>Rechazamos la hipótesis de independencia a favor de que el consumo de aspirina es diferente en pacientes con distinto tipo de úlcera.</p>
</div>
<div id="gripe-1" class="section level4" number="15.2.2.3">
<h4>
<span class="header-section-number">15.2.2.3</span> Gripe<a class="anchor" aria-label="anchor" href="#gripe-1"><i class="fas fa-link"></i></a>
</h4>
<p>Estudiamos la posible asociación entre la respuesta tars la vacunación y si el sujeto eras tratado o no.</p>
<p>Podemos cargar los datos y representarlos gráficamente</p>
<div class="sourceCode" id="cb828"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción</span>
<span class="va">fit.gripe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frequency</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">response</span>, 
                    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                    data <span class="op">=</span> <span class="va">Gripe</span><span class="op">)</span>
<span class="co"># Bondad del asjute del modelo</span>
<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">fit.gripe</span><span class="op">$</span><span class="va">deviance</span>, <span class="va">fit.gripe</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 8.95007e-05</code></pre>
<p>puesto que el p-valor obtenido es significativo podemos concluir que hay asociación entre los factores considerados, es decir, la respuesta tras la vacunación se asocia con el grupo de tratamiento.</p>
</div>
<div id="aspiraciones-1" class="section level4" number="15.2.2.4">
<h4>
<span class="header-section-number">15.2.2.4</span> Aspiraciones<a class="anchor" aria-label="anchor" href="#aspiraciones-1"><i class="fas fa-link"></i></a>
</h4>
<p>Estamso interesados en conocer si existe asociación entre el estatus, la motivacion familiar y las aspiraciones universitarias. En este caso la variable que actuaría como respuesta son las aspiraciones universitarias, mientras que las otras dos se utilizan como varaible clasificadoras. Ajustamos el modelo sin interacción triple para establecer la posible asociación.</p>
<div class="sourceCode" id="cb830"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción</span>
<span class="va">fit.aspiraciones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="op">(</span><span class="va">estatus</span> <span class="op">+</span> <span class="va">motivacion</span> <span class="op">+</span> <span class="va">aspiraciones</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, 
                    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                    data <span class="op">=</span> <span class="va">Aspiraciones</span><span class="op">)</span>
<span class="co"># Bondad del asjute del modelo</span>
<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">fit.aspiraciones</span><span class="op">$</span><span class="va">deviance</span>, <span class="va">fit.aspiraciones</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.664965</code></pre>
<p>en este caso no parece existir uan asociación entre los tres factores, pero ¿podría alguno de ellos estar asociado con las aspiraciones? ¿Cómo interpretamos los modelos siguientes?</p>
<div class="sourceCode" id="cb832"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Modelo 1</span>
<span class="va">fit.aspiraciones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">estatus</span><span class="op">*</span><span class="va">motivacion</span> <span class="op">+</span> <span class="va">aspiraciones</span> <span class="op">+</span> <span class="va">aspiraciones</span><span class="op">:</span><span class="va">motivacion</span>, 
                        family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                        data <span class="op">=</span> <span class="va">Aspiraciones</span><span class="op">)</span>
<span class="co"># Modelo 2</span>
<span class="va">fit.aspiraciones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">estatus</span><span class="op">*</span><span class="va">motivacion</span> <span class="op">+</span> <span class="va">aspiraciones</span> <span class="op">+</span> <span class="va">aspiraciones</span><span class="op">:</span><span class="va">estatus</span>, 
                        family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>,  
                        data <span class="op">=</span> <span class="va">Aspiraciones</span><span class="op">)</span></code></pre></div>
<p><strong>Ejercicio.</strong> Realiza el análisis de independencia apra los bancos de datos <code>Contraceptivos</code> y <code>Salud Laboral</code>.</p>
</div>
</div>
</div>
<div id="modelos-logit-multinomial" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Modelos Logit-Multinomial<a class="anchor" aria-label="anchor" href="#modelos-logit-multinomial"><i class="fas fa-link"></i></a>
</h2>
<p>El objetivo principal al analizar las tablas de contingenia no es sólo determinar la posible asociación entre los factores, sino tratar de predecir el comportamiento de uno de los factores (que actúa como variable respuesta) en función del resto de factores (que actúan como predictoras) cuando se detecta esta. En esta situación interesará modelizar los datos para predecir la probabilidad de que se dé una u otra respuesta en la variable respuesta en función de las distintas combinaciones en las variables predictoras.</p>
<p>Para modelizar este tipo de situación se establece una variante de los modelos log-lineales, que además de resultar útiles para investigar asociación, son equivalentes a los modelos logit para respuesta Binomial, conocidos como modelos logit-multinomial.</p>
<p>Para estudiar la especificación de este tipo de modleos nos planteamos la situacoçpn más sencilla donde consideremos una tabla de contingencia en la que están involucradas como variables de clasificación, una variable respuesta <span class="math inline">\(R\)</span> con <span class="math inline">\(I\)</span> niveles de clasificación, y una variable respuesta <span class="math inline">\(A\)</span> con <span class="math inline">\(J\)</span> niveles de clasificación. Además, denotamos por <span class="math inline">\(\pi_{i|j}\)</span> las probabilidades de respuesta <span class="math inline">\(R = i\)</span> dada cierta clasificación en la variable predictora, <span class="math inline">\((A = j)\)</span>, esto es,</p>
<p><span class="math display">\[\pi_{i|j} = P(R = i | A = j).\]</span></p>
<p>Los modelos logit-multinomial vienen definidos en términos de los log-odds (logaritmo del cociente) de las probabilidades condicionadas de dos niveles de respuesta de <span class="math inline">\(R\)</span>, dadas las diferentes combinaciones de niveles de las variables predictoras. En esta situación, y de forma similar a lo que ocurre con los modelos ANOVA, se suele elegir uno de los niveles de <span class="math inline">\(R\)</span> como nivel de referencia, generalmente el primero o el último, para predecir el cociente de probabilidades condicionadas. Si se toma como categoría de referencia la última de <span class="math inline">\(R\)</span> (en este caso I), los log-odds a predecir serán:</p>
<p><span class="math display">\[log\left(\frac{\pi_{i|j}}{\pi_{I|j}}\right), \quad \text{para cada nivel } i \text{ de } R\]</span></p>
<p>El ajuste de estos modelos logit-multinomiales se realiza a través de modelos log-lineales equivalentes con los que se predicen las frecuencias observadas <span class="math inline">\(Y_{ij}\)</span> en la tabla de contingencia. Es preciso puntualizar que la equivalencia entre estos modelos logit y los log-lineales es cierta asumiendo que los totales marginales correspondientes a las variables predictivas son fijos. Básicamente es decir que las variables predictoras han sido controladas en el estudio con el fin principal de predecir la variable respuesta <span class="math inline">\(R\)</span>. Al asumir esto, obligamos a que los efectos asociados a dichas variables predictoras hayan de aparecer siempre (junto con sus interacciones) en cualquier modelo log-lineal que ajustemos.</p>
<p>El cociente de log-odds (o logit entre las categorías <span class="math inline">\(i\)</span> e <span class="math inline">\(I\)</span>) se puede expresar como:</p>
<p><span class="math display">\[log\left(\frac{\pi_{i|j}}{\pi_{I|j}}\right) = log\left(\frac{E(Y_{ij})}{E(Y_{Ij})}\right) = log\{E(Y_{ij})\} - log\{E(Y_{Ij})\}\]</span></p>
<p>donde los <span class="math inline">\(E(Y_{ij})\)</span> para ca <span class="math inline">\(i\)</span> son los valores predichos del modelo log-lineal para cada combinación de los niveles de todas las variables involucradas. En realidad, esto significa que a la hora de estimar el log-odds sólo debemos tener en cuenta los coeficientes del modelo que hagan referencia a los niveles considerados de la variable respuesta, y a la interacción (si está presente en el modelo) entre respuesta y predictora, es decir:</p>
<p><span class="math display">\[log\left(\frac{\pi_{i|j}}{\pi_{I|j}}\right) = (\alpha_i -\alpha_I) + (\alpha\beta_{ij} - \alpha\beta_{Ij})\]</span></p>
<p>donde los <span class="math inline">\(\alpha\)</span> son los efectos asociados con los niveles de las categorías de la respuesta y los <span class="math inline">\(\alpha\beta\)</span> son los efectos asociados con la interacción entre respuesta y predictora. Esta relación tiene implicaciones importantes ya que para estimar los logits debemos tener en cuenta únicamente los coeficientes del modelo que están relacionados con la respuesta, a través de sus efectos principales o de sus interacciones con las predictoras. Este principio nos sirve para todas las situaciones de análisis que planteamos a continuación en función de las características de la variable respuesta y la predictora o predictoras.</p>
<p>Antes de comenzar, al igual que ocurria en modelizaciones anteriores, la utilización de variables ficticias numéricas para sustituir una variable categórica de tipo ordinal es una forma de proceder es muy habitual. Dichos valores numéricos se denominan en los modelos log-lineales como <code>scores</code> o valores numéricos asociados a variables de carácter ordinal. Existen dos posibilidades de asignación de estos scores:</p>
<ul>
<li>Cuando la variable ordinal viene dada en intervalos se elige el punto medio como score asociado.</li>
<li>Cuando la varaible ordinal viene dada en categorías nonuméricas se suele asociar un código numérico con el valor más bajo de 1 indicando la categoría más baja, y vamos aumentando de 1 en 1 hasta acabar con todos los niveles del factor.</li>
</ul>
</div>
<div id="estimación" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> Estimación<a class="anchor" aria-label="anchor" href="#estimaci%C3%B3n"><i class="fas fa-link"></i></a>
</h2>
<p>A continuación se presenta el proceso de estimación de los diferentes modelos logit-multinomial que pueden surgir en función de las características de la varaible respuesta y las predictoras. Se detalla cada caso siguiendo las pautas del punto anterior y se analizan los ejemplos correspondientes.</p>
<div id="respuesta-binaria-nominal-y-predictora-nominal" class="section level3" number="15.4.1">
<h3>
<span class="header-section-number">15.4.1</span> Respuesta binaria nominal y predictora nominal<a class="anchor" aria-label="anchor" href="#respuesta-binaria-nominal-y-predictora-nominal"><i class="fas fa-link"></i></a>
</h3>
<p>Imaginemos que la variable respuesta esta compuesta por dos categorías de carácter nominal (<span class="math inline">\(i=1, 2\)</span>=. Con la estructura de estimación definida en el punto anterior si la respuesta tiene únicamente dos categorías tendríamos que <span class="math inline">\(\pi_{1|j} = 1 - \pi_{2|j}\)</span>, de forma que tendríamos un único log-odds que se puede expresar como:</p>
<p><span class="math display">\[log\left(\frac{\pi_{2|j}}{\pi_{1|j}}\right) = log\left(\frac{\pi_{2|j}}{1-\pi_{2|j}}\right) = (\alpha_2 -\alpha_1) + (\alpha\beta_{2j} - \alpha\beta_{1j})\]</span></p>
<p>donde los <span class="math inline">\(\alpha\)</span> y los <span class="math inline">\(\alpha\beta\)</span> son los definidos en el punto anterior. Si denotamos por <span class="math inline">\(\eta_{2|j}\)</span> al <span class="math inline">\(log\left(\pi_{2|j}/\pi_{1|j}\right)\)</span>, a partir de la expresión anterior resulta posible obtener la probabilidad de cada nivel de la respuesta mediante la ecuación:</p>
<p><span class="math display">\[\pi_{2|j} = \frac{exp(\eta_{2|j})}{1+exp(\eta_{2|j})}\]</span></p>
<div id="datos-aspirina" class="section level4" number="15.4.1.1">
<h4>
<span class="header-section-number">15.4.1.1</span> Datos Aspirina<a class="anchor" aria-label="anchor" href="#datos-aspirina"><i class="fas fa-link"></i></a>
</h4>
<p>En primer lugar calculamos y evaluamos los logits empíricos asociados y más tarde realizamos el ajuste y estimación delm modelo. Tomamos como variable respuesta el consumo de aspirina, y usamos como referencia la categroria <code>No</code> podemos obtener los log-odds como:</p>
<div class="sourceCode" id="cb833"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creamos variable con valores de referencia y obtenemos los log-odds asociados</span>
<span class="va">referencia.val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Aspirina</span>, <span class="va">aspirina</span> <span class="op">==</span> <span class="st">"No"</span><span class="op">)</span>,
                                       <span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Log-odds</span>
<span class="va">Aspirina</span> <span class="op">&lt;-</span> <span class="va">Aspirina</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>referencia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">referencia.val</span>, <span class="fl">2</span><span class="op">)</span>,
         lodds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">/</span> <span class="va">referencia</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="co"># Seleccionamos las categorías a representar eliminando la de referencia</span>
<span class="co"># Como la respuesta sólo tiene una categoría no hace falta utilizarla en el gráfico</span>
<span class="va">datos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Aspirina</span>, <span class="va">aspirina</span> <span class="op">!=</span> <span class="st">"No"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">locali</span>, y <span class="op">=</span> <span class="va">lodds</span>, group <span class="op">=</span> <span class="va">ulcera</span>, color <span class="op">=</span> <span class="va">ulcera</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Localización"</span>,
       y <span class="op">=</span> <span class="st">"log-odds (Aspirina == Si/No)"</span>,
       col <span class="op">=</span> <span class="st">"Desarrollo de úlcera"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont014-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>Ajustamos un modelo con todas las interacciones dobles, ya que en este caso resulta imposible plantear el modelo con las interacción triple. Este modelo el que ya se planteo en el estudio de independencia.</p>
<div class="sourceCode" id="cb834"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción</span>
<span class="va">fit.aspirina</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="op">(</span><span class="va">locali</span> <span class="op">+</span> <span class="va">ulcera</span> <span class="op">+</span> <span class="va">aspirina</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, 
              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
              data <span class="op">=</span> <span class="va">Aspirina</span><span class="op">)</span></code></pre></div>
<p>Para obtener los logits y probabilidades asociadas a cada categoría de la respuesta extraemos los coeficientes del modelo ajustado. Dado que solo nos interesan los efectos que están relaciondos directamente con la variable respuesta vamos a presentar únicamente dichos valores. Para saber los nombres de los coeficientes del modelo podemos utilizar el código siguiente identificando todos los efectos que están realcionados con la respuesta (efecto principal e interacciones).</p>
<p>En estos modelos utilizamos la función La función <code>tidy</code> para presentar la estimación del modelo selecionando las columnas necesarias.</p>
<div class="sourceCode" id="cb835"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">fit.aspirina</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"term"</span>, <span class="st">"estimate"</span><span class="op">)</span><span class="op">]</span>
<span class="va">tabla</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   term                      estimate
##   &lt;chr&gt;                        &lt;dbl&gt;
## 1 (Intercept)                 3.75  
## 2 localiDuodenal              0.0698
## 3 ulceraNo                    0.321 
## 4 aspirinaSi                 -0.679 
## 5 localiDuodenal:ulceraNo    -0.106 
## 6 localiDuodenal:aspirinaSi  -0.700 
## 7 ulceraNo:aspirinaSi        -1.14</code></pre>
<p>Seleccionamos los efectos necesarios para el ajuste de los logits y la estimación de probabilidades. Estos efectos son los relacionados (principales e interacciones) con la variable <code>aspirina</code>.</p>
<div class="sourceCode" id="cb837"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filas de la tabla de estimaciones relacionados con metodo</span>
<span class="va">selefect</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>
<span class="va">tabla</span><span class="op">[</span><span class="va">selefect</span>,<span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   term                      estimate
##   &lt;chr&gt;                        &lt;dbl&gt;
## 1 aspirinaSi                  -0.679
## 2 localiDuodenal:aspirinaSi   -0.700
## 3 ulceraNo:aspirinaSi         -1.14</code></pre>
<p>Dado que ambas variables son de tipo nominal y tomando como referencia la categoría “No” de consumo de aspirina, podemos obtener el logit del consumo de aspirina versus la categoria de referencia para cualquier combinación der categorias de las predictoras mediante:</p>
<p><span class="math display">\[log\left(\frac{\pi_{SI|jk}}{\pi_{No|jk}}\right) = (\alpha_{Si} - \alpha_{No}) + (\theta_{Si,jk} - \theta_{No,jk})\]</span></p>
<p>donde <span class="math inline">\(\alpha\)</span> hace referencia al efecto principal asociado con la respuesta (<code>aspirina</code>), y <span class="math inline">\(\theta\)</span> hace referencia al coeficiente de interacción entre la respuesta y los niveles <span class="math inline">\(j\)</span> y <span class="math inline">\(k\)</span> de localización de la úlcera (<code>locali</code>) y tener úlcera (<code>ulcera</code>) respectivamente. Si denotamos por <span class="math inline">\(A\)</span> al consumo de aspirina, <span class="math inline">\(L\)</span> la localización de la úlcera, y <span class="math inline">\(U\)</span> tener o no tener úlcera, para obtener el logit para un sujeto con <span class="math inline">\(U = No\)</span> y <span class="math inline">\(L = Duodenal\)</span> tendríamos que:</p>
<p><span class="math display">\[\eta_\text{Si| U = NO; L = Duodenal} = (\alpha_{Si} - \alpha_{No}) + (\theta_{Si,No,Duodenal} - \theta_{No,No,Duodenal})\]</span></p>
<p>donde <span class="math inline">\(\alpha_{Si} = -0.679\)</span>, <span class="math inline">\(\alpha_{No} = 0\)</span>, y <span class="math inline">\(\theta_{Si,No,Duodenal}\)</span>, <span class="math inline">\(\theta_{No,No,Duodenal}\)</span> representan las interacciones de la respuesta y predictoras para dicha combinación que vienen dadas por:</p>
<p><span class="math display">\[\begin{array}{ll}
\theta_{Si,No,Duodenal} &amp;= \theta_{Si,No} + \theta_{Si,Duodenal} = - 1.14 - 0.70 = - 1.84\\
\theta_{No,No,Duodenal} &amp;= \theta_{No,No} + \theta_{No,Duodenal} = 0 + 0 = 0\\
\end{array}\]</span></p>
<p>Para la estimación de los logits hya que tener en cuenta las restricciones de identificabilidad <span class="math inline">\(\alpha_{No} = 0\)</span> y <span class="math inline">\(\theta_{No,jk} = 0\)</span> para cualquier combinación de <span class="math inline">\(j\)</span> y <span class="math inline">\(k\)</span>, de forma que:</p>
<p><span class="math display">\[\begin{array}{ll}
\eta_\text{[Si| U = No; L = Duodenal]} &amp;= \alpha_{Si} + \theta_{Si,No} + \theta_{Si,Duodenal} = - 0.679 - 1.84 = -2.519\\
\eta_\text{[Si| U = No; L = Gástrica]} &amp; = \alpha_{Si} + \theta_{Si,No} + \theta_{Si,Gástrica} = - 0.679 - 1.14 + 0 = -1.819\\
\eta_\text{[Si| U = Si; L = Duodenal]} &amp; = \alpha_{Si} + \theta_{Si,Si} + \theta_{Si,Duodenal} = - 0.679 + 0 - 0.70 = -1.379\\
\eta_\text{[Si| U = Si; L = Gástrica]} &amp; = \alpha_{Si} + \theta_{Si,Si} + \theta_{Si,Gástrica} = - 0.679 + 0 + 0 = - 0.679\\
\end{array}\]</span></p>
<p>Podemos obtener ahora las probabilidades de consumo de aspirina para cada combinación de las predictoras:</p>
<p><span class="math display">\[\begin{array}{ll}
\pi_\text{[Si| U = NO; L = Duodenal]} &amp; =  exp(-2.519)/(1+exp(-2.519)) = 0.0745\\
\pi_\text{[Si| U = NO; L = Gástrica]} &amp; =  exp(-1.819)/(1+exp(-1.819)) = 0.1396\\
\pi_\text{[Si| U = Si; L = Duodenal]} &amp; =  exp(-1.379)/(1+exp(-1.379)) = 0.2012\\
\pi_\text{[Si| U = Si; L = Gástrica]} &amp; =  exp(-0.679)/(1+exp(-0.679)) = 0.3365\\
\end{array}\]</span></p>
<p>A la vista de estos resultados podemos concluir que la probabilidad de consumir aspirina dado un enfermo de úlcera duodenal es de 0.2012, mientras que para un enfermo de úlcera gástrica dicha probabilidad es de 0.3365. Podemos concluir que la probabilidad del consumo de aspirina es superior en los enfermos con úlcera gástrica que en la duodenal, y mayor en los sujetos enfermos que en los controles.</p>
<p>Las probabilidades anteriores se puden obtener de forma un poco más directa a partir de los valores predichos del modelo.</p>
<div class="sourceCode" id="cb839"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculamos los conteos predichos del modelo</span>
<span class="va">conteos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.aspirina</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="co"># Combinamos los datos originales con los predichos</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Aspirina</span>, <span class="va">conteos</span><span class="op">)</span>
<span class="co"># Calculamos el conteo total por las predictoras</span>
<span class="va">newdata.sum</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">locali</span>, <span class="va">ulcera</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>suma <span class="op">=</span> <span class="fu"><a href="https://www.mosaic-web.org/mosaic/reference/aggregating.html">sum</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Calculamos las probabilidades asociadas a cada combinación</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">newdata.sum</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"locali"</span>,<span class="st">"ulcera"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">/</span><span class="va">suma</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Vemos las probabiliddes obtenidas</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">newdata</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">locali</span>, <span class="va">ulcera</span>, <span class="va">aspirina</span>, <span class="va">prob</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##     locali ulcera aspirina   prob
## 1 Gástrica     Si       No 0.6635
## 2 Gástrica     No       No 0.8608
## 3 Duodenal     Si       No 0.7988
## 4 Duodenal     No       No 0.9257
## 5 Gástrica     Si       Si 0.3365
## 6 Gástrica     No       Si 0.1392
## 7 Duodenal     Si       Si 0.2012
## 8 Duodenal     No       Si 0.0743</code></pre>
<p>Podemos representar las probabilidades obtenidas para ver los efectos de la combinacion de predictoras en la respuesta.</p>
<div class="sourceCode" id="cb841"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">locali</span>, y <span class="op">=</span> <span class="va">prob</span>, group <span class="op">=</span> <span class="va">ulcera</span>, color <span class="op">=</span> <span class="va">ulcera</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">aspirina</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Consumo de aspirina"</span>,
       x <span class="op">=</span> <span class="st">"Localización de la úlcera"</span>,
       y <span class="op">=</span> <span class="st">"Probabilidad"</span>,
       col <span class="op">=</span> <span class="st">"Úlcera"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont019-1.png" width="95%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="respuesta-multinomial-nominal-y-predictora-nominal" class="section level3" number="15.4.2">
<h3>
<span class="header-section-number">15.4.2</span> Respuesta multinomial nominal y predictora nominal<a class="anchor" aria-label="anchor" href="#respuesta-multinomial-nominal-y-predictora-nominal"><i class="fas fa-link"></i></a>
</h3>
<p>Cuando tenemos más de dos categorías el procedimiento es bastante similar. En este caso tomamos la última categoria <span class="math inline">\(I\)</span> como referencia, de forma que los log-odds se pueden expresar como:</p>
<p><span class="math display">\[log\left(\frac{\pi_{i|j}}{\pi_{I|j}}\right) = \eta_{i|j} = (\alpha_i -\alpha_I) + (\alpha\beta_{ij} - \alpha\beta_{Ij})\]</span></p>
<p>A partir del logit anterior para cada categoría <span class="math inline">\(i\)</span>,podemos obtener la probabilidad condicionada de dicha categoría <span class="math inline">\(i\)</span> como:</p>
<p><span class="math display">\[\pi_{i|j} = \frac{exp(\eta_{i|j})}{\sum_{l=1}^I exp(\eta_{l|j})}\]</span></p>
<p>Puesto que <span class="math inline">\(exp(\eta_{I|j}) = 1\)</span> dicha probabilidad se puede expresar como:</p>
<p><span class="math display">\[\pi_{i|j} = \frac{exp(\eta_{i|j})}{1 + \sum_{l \neq I} exp(\eta_{l|j})}\]</span></p>
<p>Esta expresión es similar a la de dos categorías salvo por la modificación del denominador, donde se incluyen los predictores, <span class="math inline">\(\eta\)</span>, asociados a todas las categorías de la respuesta.</p>
</div>
<div id="respuesta-nominal-predictora-ordinal" class="section level3" number="15.4.3">
<h3>
<span class="header-section-number">15.4.3</span> Respuesta nominal, predictora ordinal<a class="anchor" aria-label="anchor" href="#respuesta-nominal-predictora-ordinal"><i class="fas fa-link"></i></a>
</h3>
<p>Esta situación es miliar a la anterior salvo por el carácter ordinal de la predictora. Para estimar dichos modelos debemos incluir una variable ficticia (<span class="math inline">\(S\)</span>) que contendrá los scores asociados con las categorías de la predictora. Si <span class="math inline">\(v_1=1, v_2=2,...,v_J=J\)</span> denota a los scores asociados con la varaible ordinal, el logit asociado a esta situación se puede expresar mediante:</p>
<p><span class="math display">\[log\left(\frac{\pi_{i|j}}{\pi_{I|j}}\right) = \eta_{i|j} = (\alpha_i -\alpha_I) + (\alpha\beta_{ij} - \alpha\beta_{Ij})v_j\]</span></p>
<p>donde las interacciones entre la respuesta y la predictora se modifican a través del score definido, para introducir el efecto ordinal entre las comninaciones, de forma que los cocientes de probabilidades se obtienen como</p>
<p><span class="math display">\[\frac{\pi_{i|j}}{\pi_{I|j}} = exp(\eta_{i|j}) = exp\{(\alpha_i -\alpha_I) + (\alpha\beta_{ij} - \alpha\beta_{Ij})v_j\}\]</span></p>
<p>de forma que la probabilidad de una categoría <span class="math inline">\(i\)</span> viene dada por:</p>
<p><span class="math display">\[\pi_{i|j} = \frac{exp(\eta_{i|j})}{1 + \sum_{l \neq I} exp(\eta_{l|j})}\]</span></p>
<div id="datos-aspiraciones-universitarias" class="section level4" number="15.4.3.1">
<h4>
<span class="header-section-number">15.4.3.1</span> Datos Aspiraciones universitarias<a class="anchor" aria-label="anchor" href="#datos-aspiraciones-universitarias"><i class="fas fa-link"></i></a>
</h4>
<p>Si tomamos como variable respuesta las aspiraciones universitarias en función del estatus económico y de la motivación familiar, y usamos como referencia la categoría <code>No</code> podemos obtener el log-odd de la categoría <code>Si</code> mediante:</p>
<div class="sourceCode" id="cb842"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creamos variable con valores de referencia y obtenemos los log-odds asociados</span>
<span class="va">referencia.val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Aspiraciones</span>, <span class="va">aspiraciones</span> <span class="op">==</span> <span class="st">"No"</span><span class="op">)</span>,
                                       <span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span>
<span class="va">Aspiraciones</span> <span class="op">&lt;-</span> <span class="va">Aspiraciones</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>referencia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">referencia.val</span>, <span class="fl">2</span><span class="op">)</span>,
         lodds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">/</span> <span class="va">referencia</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="co"># Seleccionamos las categorías a representar eliminando la de referencia</span>
<span class="co"># Como la respuesta sólo tiene una categoría no hace falta utilizarla en el gráfico</span>
<span class="va">datos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Aspiraciones</span>, <span class="va">aspiraciones</span> <span class="op">!=</span> <span class="st">"No"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estatus</span>, y <span class="op">=</span> <span class="va">lodds</span>, group <span class="op">=</span> <span class="va">motivacion</span>, color <span class="op">=</span> <span class="va">motivacion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Estatus Socioeconómico"</span>,
       y <span class="op">=</span> <span class="st">"log-odds (Aspiraciones == Si / No)"</span>,
       col <span class="op">=</span> <span class="st">"Motivacion"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont020-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>Se observa una tendencia creciente (puede incluso que no lineal) conforme aumenta el estatus económico, que va relacionada directamente con una motivación más alta en el entorno familiar (comportamiento casi paralelo para ambas motivaciones).</p>
<p>Para el ajuste de este modelo debemos considerar los scores asociados a cada una de las predictoras ordinales (<code>estatus.num</code> y <code>motivacion.num</code>) tal y como los definimos al presentar este banco de datos. En primer lugar ajustamos el modelo para estudiar asociación eliminando la interacción de orden 3.</p>
<div class="sourceCode" id="cb843"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción triple</span>
<span class="va">fit.aspiraciones.aso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="op">(</span><span class="va">estatus</span> <span class="op">+</span> <span class="va">motivacion</span> <span class="op">+</span> <span class="va">aspiraciones</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, 
                          family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                          data <span class="op">=</span> <span class="va">Aspiraciones</span><span class="op">)</span>
<span class="co"># Bondad del asjute del modelo</span>
<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">fit.aspiraciones.aso</span><span class="op">$</span><span class="va">deviance</span>, <span class="va">fit.aspiraciones.aso</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.664965</code></pre>
<p>No podemos rechazar la interacción triple. Ajustamos un nuevo modelo eliminando la interacción doble entre <code>estatus</code> y <code>motivacion</code> dado que los prefiles de los logits parecían paralelos.</p>
<div class="sourceCode" id="cb845"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción triple</span>
<span class="va">fit.aspiraciones.aso2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">estatus</span> <span class="op">+</span> <span class="va">motivacion</span> <span class="op">+</span> <span class="va">aspiraciones</span> <span class="op">+</span> <span class="va">estatus</span><span class="op">:</span><span class="va">aspiraciones</span> <span class="op">+</span> <span class="va">motivacion</span><span class="op">:</span><span class="va">aspiraciones</span>, 
                          family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                          data <span class="op">=</span> <span class="va">Aspiraciones</span><span class="op">)</span>
<span class="co"># Bondad del ajuste</span>
<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">fit.aspiraciones.aso2</span><span class="op">$</span><span class="va">deviance</span>, <span class="va">fit.aspiraciones.aso2</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb847"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Comapramos con el modelo anterior</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fit.aspiraciones.aso2</span>, <span class="va">fit.aspiraciones.aso</span>, test <span class="op">=</span><span class="st">"Chisq"</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: frecuencia ~ estatus + motivacion + aspiraciones + estatus:aspiraciones + 
##     motivacion:aspiraciones
## Model 2: frecuencia ~ (estatus + motivacion + aspiraciones)^2
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1         6    298.485                          
## 2         3      1.575  3   296.91 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>El p-valor resulta significativo dando indicaciones de que la interacción <code>estatus:motivacion</code> no es relevante pero este modelo si que es distinto del modelo saturado. Ajustamos este modelo teniendo en cuenta los scores:</p>
<div class="sourceCode" id="cb849"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Debemos incluir el efecto de las predictoras como factor principal </span>
<span class="co"># para mantener la estructura del modelo</span>
<span class="va">fit.aspiraciones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">estatus</span> <span class="op">+</span> <span class="va">motivacion</span> <span class="op">+</span> <span class="va">aspiraciones</span> <span class="op">+</span> <span class="va">aspiraciones</span><span class="op">*</span><span class="op">(</span><span class="va">estatus.num</span> <span class="op">+</span> <span class="va">motivacion.num</span><span class="op">)</span>, 
                          family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                          data <span class="op">=</span> <span class="va">Aspiraciones</span><span class="op">)</span></code></pre></div>
<p>Obtenemos la tabla de estimación para el modelo:</p>
<div class="sourceCode" id="cb850"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">fit.aspiraciones</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"term"</span>, <span class="st">"estimate"</span><span class="op">)</span><span class="op">]</span>
<span class="va">tabla</span></code></pre></div>
<pre><code>## # A tibble: 10 × 2
##    term                          estimate
##    &lt;chr&gt;                            &lt;dbl&gt;
##  1 (Intercept)                     6.42  
##  2 estatusMedia-Baja              -0.0318
##  3 estatusMedia-Alta              -0.307 
##  4 estatusAlta                    -0.780 
##  5 motivacionAlta                 -0.482 
##  6 aspiracionesSi                 -7.81  
##  7 estatus.num                    NA     
##  8 motivacion.num                 NA     
##  9 aspiracionesSi:estatus.num      0.806 
## 10 aspiracionesSi:motivacion.num   3.01</code></pre>
<p>Seleccionamos los efectos necesarios para el ajuste de los logits y la estimación de probabilidades. Estos efectos son los relacionados (principales e interacciones) con la variable <code>aspiraciones</code>.</p>
<div class="sourceCode" id="cb852"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filas de la tabla de estimaciones relacionados con metodo</span>
<span class="va">tabla</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">8</span>,<span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   term           estimate
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 aspiracionesSi    -7.81
## 2 estatus.num       NA   
## 3 motivacion.num    NA</code></pre>
<p>Con una variable respuesta nominal y una predictora ordinal la ecuació del logit (tomando la categoría <code>No</code> como referencia) se pueden obtener de forma sencilla a partir de las ecuaciones descritas anteriormente. La expresión del logit en función de los niveles de las predictoras viene dada por:</p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{Si,jk}}}{\pi_{\text{No,jk}}}\right) = (\alpha_{\text{Si}} - \alpha_{\text{No}}) + (\theta_{Si,j} - \theta_{No,j}) v_j + (\gamma_{Si,k} - \gamma_{No,k}) w_k \\ = \alpha_{\text{Si}} + \theta_{Si,j} v_j + \gamma_{Si,k} w_k\]</span></p>
<p>donde los <span class="math inline">\(\alpha\)</span> representan los efectos principales de <code>aspiraciones</code>, <span class="math inline">\(\theta\)</span> los efectos de las interacciones entre <code>aspiraciones</code> y <code>estatus</code>, <span class="math inline">\(\gamma\)</span> los efectos de las interacciones entre <code>aspiraciones</code> y <code>motivacion</code>, los <span class="math inline">\(v_j\)</span> son los scores de <code>estatus</code>, y los <span class="math inline">\(\gamma_k\)</span> son los scores de <code>motivacion</code>. Sustituyendo tendríamos:</p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{Si,jk}}}{\pi_{\text{No,jk}}}\right) = - 7.81 + 0.806 v_j + 3.01 w_k\]</span></p>
<p>Dando valores a <span class="math inline">\(v_j\)</span> (de 1 a 4) y a <span class="math inline">\(w_k\)</span> (de 1 a 2) podemos obtener el logit asociado con la variable respuesta. En este caso pasamos directamente a estimar las probabilidades de cada combinación.</p>
<div class="sourceCode" id="cb854"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculamos los conteos predichos del modelo</span>
<span class="va">conteos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.aspiraciones</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="co"># Combinamos los datos originales con los predichos</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Aspiraciones</span>, <span class="va">conteos</span><span class="op">)</span>
<span class="co"># Calculamos el conteo total por las predictoras</span>
<span class="va">newdata.sum</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">estatus</span>, <span class="va">motivacion</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>suma <span class="op">=</span> <span class="fu"><a href="https://www.mosaic-web.org/mosaic/reference/aggregating.html">sum</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Calculamos las probabilidades asociadas a cada combinación</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">newdata.sum</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"estatus"</span>, <span class="st">"motivacion"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">/</span><span class="va">suma</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Vemos las probabiliddes obtenidas</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">newdata</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">estatus</span>, <span class="va">motivacion</span>, <span class="va">aspiraciones</span>, <span class="va">prob</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##       estatus motivacion aspiraciones   prob
## 1        Baja       Baja           No 0.9819
## 2        Baja       Alta           No 0.7282
## 3  Media-Baja       Baja           No 0.9604
## 4  Media-Baja       Alta           No 0.5448
## 5  Media-Alta       Baja           No 0.9156
## 6  Media-Alta       Alta           No 0.3484
## 7        Alta       Baja           No 0.8289
## 8        Alta       Alta           No 0.1928
## 9        Baja       Baja           Si 0.0181
## 10       Baja       Alta           Si 0.2718
## 11 Media-Baja       Baja           Si 0.0396
## 12 Media-Baja       Alta           Si 0.4552
## 13 Media-Alta       Baja           Si 0.0844
## 14 Media-Alta       Alta           Si 0.6516
## 15       Alta       Baja           Si 0.1711
## 16       Alta       Alta           Si 0.8072</code></pre>
<p>Podemos representar las probabilidades obtenidas para ver los efectos de la combinacion de predictoras en la respuesta.</p>
<div class="sourceCode" id="cb856"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estatus</span>, y <span class="op">=</span> <span class="va">prob</span>, group <span class="op">=</span> <span class="va">aspiraciones</span>, color <span class="op">=</span> <span class="va">aspiraciones</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">motivacion</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Probabilidades estimadas por motivacion"</span>,
       x <span class="op">=</span> <span class="st">"Edad"</span>,
       y <span class="op">=</span> <span class="st">"Probabilidad"</span>,
       col <span class="op">=</span> <span class="st">"Método anticonceptivo"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont027-1.png" width="95%" style="display: block; margin: auto;"></div>
</div>
<div id="datos-de-contraceptivos" class="section level4" number="15.4.3.2">
<h4>
<span class="header-section-number">15.4.3.2</span> Datos de Contraceptivos<a class="anchor" aria-label="anchor" href="#datos-de-contraceptivos"><i class="fas fa-link"></i></a>
</h4>
<p>Si tomamos como variable respuesta el método anticonceptivo utilizado, y usamos como referencia la categroria <code>Ninguno</code> podemos obtener los log-odds de la otras dos categorías como:</p>
<div class="sourceCode" id="cb857"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creamos variable con valores de referencia y obtenemos los log-odds asociados</span>
<span class="va">referencia.val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Contraceptivos</span>, <span class="va">metodo</span> <span class="op">==</span> <span class="st">"Ninguno"</span><span class="op">)</span>, <span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span>
<span class="va">Contraceptivos</span> <span class="op">&lt;-</span> <span class="va">Contraceptivos</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>referencia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">referencia.val</span>, <span class="fl">3</span><span class="op">)</span>,
         lodds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">/</span> <span class="va">referencia</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="co"># Seleccionamos las categorías a representar eliminando la de referencia</span>
<span class="co"># Como la respuesta sólo tiene una categoría no hace falta utilizarla en el gráfico</span>
<span class="va">datos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Contraceptivos</span>, <span class="va">metodo</span> <span class="op">!=</span> <span class="st">"Ninguno"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">edad</span>, y <span class="op">=</span> <span class="va">lodds</span>, group <span class="op">=</span> <span class="va">metodo</span>, color <span class="op">=</span> <span class="va">metodo</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Grupo de edad"</span>,
       y <span class="op">=</span> <span class="st">"log-odds (Ref: Método == Ninguno)"</span>,
       col <span class="op">=</span> <span class="st">"Método anticonceptivo"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont028-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>Se observan claramente tendencias cuadráticas distintas para cada método asociadas con el grupo de edad considerado. Aprovecharemos el carácter ordinal de dicha variable para incluir una nueva variable que contenga la marca de clase de cada grupo de edad (score), que nos permita ajustar el modelo cuadrático con edad.</p>
<p>Dado que sólo tenemos una predictora vamos a ajustar un modelo sólo con efectos principales. Estudiamos la bondad del ajuste de dicho modelo para conocer el patrón de asociación entre las variables. Si desechamos la interacción doble concluiríamos que no existe asociación entre edad y método contraceptivo. En caso contrario deberíamos establecer el modelo de asociación entre ambas variables. El gráfico de log-odds muestra cierto grado de asociación de tipo cuadrático con la edad. Se debe explorar la posibilidd de un modelo de interacción con la variable de scores de edad asumiendo un modelo cuadrático.</p>
<div class="sourceCode" id="cb858"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo sin interacción</span>
<span class="va">fit.contraceptivos.aso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">edad</span> <span class="op">+</span> <span class="va">metodo</span>, 
                          family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                          data <span class="op">=</span> <span class="va">Contraceptivos</span><span class="op">)</span>
<span class="co"># Bondad del asjute del modelo</span>
<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">fit.contraceptivos.aso</span><span class="op">$</span><span class="va">deviance</span>, <span class="va">fit.contraceptivos.aso</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Rechazamos la hipótesis de independencia. Ajustamos el modelo de interacción cuadrático con los scores de la variable edad que ya fijamos en la presentación del banco de datos (punto medio de los intervalos de edad). En este modelo incluimos la edad como factor principal, y los scores de la edad en interacción con la variable método anticonceptivo.</p>
<div class="sourceCode" id="cb860"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo con efecto cuadrático en edad</span>
<span class="co"># Debemos incluir el efecto edad como factor principal </span>
<span class="co"># para mantener la estructura del modelo</span>
<span class="va">fit.contraceptivos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">edad</span> <span class="op">+</span> <span class="va">metodo</span><span class="op">*</span><span class="op">(</span><span class="va">edad.num</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">edad.num</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, 
                          family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
                          data <span class="op">=</span> <span class="va">Contraceptivos</span><span class="op">)</span></code></pre></div>
<p>Comparamos los dos modelos obtenidos para validar la inclusión de la variable de scores de edad</p>
<div class="sourceCode" id="cb861"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fit.contraceptivos.aso</span>, <span class="va">fit.contraceptivos</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: frecuencia ~ edad + metodo
## Model 2: frecuencia ~ edad + metodo * (edad.num + I(edad.num^2))
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1        12     521.10                          
## 2         8      20.47  4   500.63 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Dado que el p-valor resulta significativo podemos conluir que ambos modelos son distintos.</p>
<p>Obtenemos la tabla de estimación para el modelo:</p>
<div class="sourceCode" id="cb863"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">fit.contraceptivos</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"term"</span>, <span class="st">"estimate"</span><span class="op">)</span><span class="op">]</span>
<span class="va">tabla</span></code></pre></div>
<pre><code>## # A tibble: 15 × 2
##    term                        estimate
##    &lt;chr&gt;                          &lt;dbl&gt;
##  1 (Intercept)                  2.26   
##  2 edad20-24                    2.14   
##  3 edad25-29                    3.04   
##  4 edad30-34                    3.28   
##  5 edad35-39                    3.16   
##  6 edad40-44                    2.78   
##  7 edad45-49                    2.13   
##  8 metodoOtros                  7.85   
##  9 metodoNinguno               12.3    
## 10 edad.num                    NA      
## 11 I(edad.num^2)               NA      
## 12 metodoOtros:edad.num        -0.441  
## 13 metodoNinguno:edad.num      -0.700  
## 14 metodoOtros:I(edad.num^2)    0.00497
## 15 metodoNinguno:I(edad.num^2)  0.00973</code></pre>
<p>Seleccionamos los efectos necesarios para el ajuste de los logits y la estimación de probabilidades. Estos efectos son los relacionados (principales e interacciones) con la variable <code>metodo</code>.</p>
<div class="sourceCode" id="cb865"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filas de la tabla de estimaciones relacionados con metodo</span>
<span class="va">tabla</span><span class="op">[</span><span class="fl">8</span><span class="op">:</span><span class="fl">13</span>,<span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   term                   estimate
##   &lt;chr&gt;                     &lt;dbl&gt;
## 1 metodoOtros               7.85 
## 2 metodoNinguno            12.3  
## 3 edad.num                 NA    
## 4 I(edad.num^2)            NA    
## 5 metodoOtros:edad.num     -0.441
## 6 metodoNinguno:edad.num   -0.700</code></pre>
<p>Con una variable respuesta nominal y una predictora ordinal la ecuació del logit (tomando la categoría <code>Ninguno</code> como referencia) se pueden obtener de forma sencilla a partir de las ecuaciones descritas anteriormente. Para simplificar las expresiones utilizamos la codificación de categorias de la variable <code>metodo</code>: <code>Esterilizacion = E</code>, <code>Ninguno = N</code>, y <code>Otros = O</code>. Las expresiones de los logits en función de la edad son:</p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{E,j}}}{\pi_{\text{N,j}}}\right) = (\alpha_{\text{E}} - \alpha_{\text{N}}) + (\theta_{E,j} - \theta_{N,j}) v_j + (\theta^2_{E,j} - \theta^2_{N,j}) v^2_j\]</span></p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{O,j}}}{\pi_{\text{N,j}}}\right) = (\alpha_{\text{O}} - \alpha_{\text{N}}) + (\theta_{O,j} - \theta_{N,j}) v_j + (\theta^2_{O,j} - \theta^2_{N,j}) v^2_j\]</span></p>
<p>donde los <span class="math inline">\(\alpha\)</span> representan los efectos principales, <span class="math inline">\(\theta\)</span> los efectos de las interacciones con el efecto lineal del score, <span class="math inline">\(\theta^2\)</span> los efectos de las interacciones con el efecto cuadrático del score, y los <span class="math inline">\(v_j\)</span> son los scores de la edad. Sustituyendo tendríamos:</p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{E,j}}}{\pi_{\text{N,j}}}\right) = (0 - 12.30) + (0 + 0.70) v_j + (0 - 0.00973) v^2_j \\ = - 12.30 + 0.70 v_j - 0.00973 v^2_j\]</span></p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{O,j}}}{\pi_{\text{N,j}}}\right) = (7.85 - 12.30) + (-0.441 + 0.70) v_j + (0.00497 - 0.00973) v^2_j \\ = - 4.45 + 0.259 v_j - 0.00476 v^2_j\]</span></p>
<p>Podemos representar los logits obtenidos en función de la edad:</p>
<div class="sourceCode" id="cb867"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Secuencia de edad</span>
<span class="va">edadsec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">49</span>,<span class="fl">1</span><span class="op">)</span>
<span class="co"># Valores logit comparada con la de referencia</span>
<span class="va">EvsN</span> <span class="op">&lt;-</span> <span class="op">-</span> <span class="fl">12.30</span> <span class="op">+</span> <span class="fl">0.70</span><span class="op">*</span><span class="va">edadsec</span> <span class="op">-</span> <span class="fl">0.00973</span><span class="op">*</span><span class="va">edadsec</span><span class="op">^</span><span class="fl">2</span>
<span class="va">OvsN</span> <span class="op">&lt;-</span> <span class="op">-</span> <span class="fl">4.45</span> <span class="op">+</span> <span class="fl">0.259</span><span class="op">*</span><span class="va">edadsec</span> <span class="op">-</span> <span class="fl">0.00476</span><span class="op">*</span><span class="va">edadsec</span><span class="op">^</span><span class="fl">2</span>
<span class="co"># Configuración de datos para logits</span>
<span class="va">edad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">edadsec</span>,<span class="fl">2</span><span class="op">)</span>
<span class="va">combinacion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"E versus N"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">edadsec</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"O versus N"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">edadsec</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">logits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">EvsN</span>, <span class="va">OvsN</span><span class="op">)</span>
<span class="va">datoscom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edad</span>, <span class="va">combinacion</span>, <span class="va">logits</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datoscom</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">edad</span>, y <span class="op">=</span> <span class="va">logits</span>, group <span class="op">=</span> <span class="va">combinacion</span>, color <span class="op">=</span> <span class="va">combinacion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Logits por edad"</span>, 
       y <span class="op">=</span> <span class="st">"Logits"</span>, 
       x <span class="op">=</span> <span class="st">"Edad"</span>,
       col <span class="op">=</span> <span class="st">"Comparación"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont034-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>Los logits estimados reproducen el comportamiento observado en los logits empíricos.</p>
<p>Por último obtnemos las probabilidades de cada combinación, que en este caso su evolución como función de la edad. En lugar de evaluar los logits utilizaremos la función predict para evaluar dichas probabildiades y representarlas gráficamente.</p>
<div class="sourceCode" id="cb868"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculamos los conteos predichos del modelo</span>
<span class="va">conteos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.contraceptivos</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="co"># Combinamos los datos originales con los predichos</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Contraceptivos</span>, <span class="va">conteos</span><span class="op">)</span>
<span class="co"># Calculamos el conteo total por las predictoras</span>
<span class="va">newdata.sum</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">edad</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>suma <span class="op">=</span> <span class="fu"><a href="https://www.mosaic-web.org/mosaic/reference/aggregating.html">sum</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Calculamos las probabilidades asociadas a cada combinación</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">newdata.sum</span>, by <span class="op">=</span> <span class="st">"edad"</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">/</span><span class="va">suma</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Vemos las probabiliddes obtenidas</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">newdata</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">edad</span>, <span class="va">metodo</span>, <span class="va">prob</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##     edad         metodo   prob
## 1  15-19 Esterilización 0.0322
## 2  20-24 Esterilización 0.1318
## 3  25-29 Esterilización 0.3086
## 4  30-34 Esterilización 0.4632
## 5  35-39 Esterilización 0.5192
## 6  40-44 Esterilización 0.4572
## 7  45-49 Esterilización 0.2832
## 8  15-19          Otros 0.1936
## 9  20-24          Otros 0.2306
## 10 25-29          Otros 0.2018
## 11 30-34          Otros 0.1451
## 12 35-39          Otros 0.0999
## 13 40-44          Otros 0.0693
## 14 45-49          Otros 0.0434
## 15 15-19        Ninguno 0.7741
## 16 20-24        Ninguno 0.6376
## 17 25-29        Ninguno 0.4895
## 18 30-34        Ninguno 0.3917
## 19 35-39        Ninguno 0.3809
## 20 40-44        Ninguno 0.4734
## 21 45-49        Ninguno 0.6734</code></pre>
<p>Podemos representar las probabilidades obtenidas para ver los efectos de la combinacion de predictoras en la respuesta.</p>
<div class="sourceCode" id="cb870"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">edad</span>, y <span class="op">=</span> <span class="va">prob</span>, group <span class="op">=</span> <span class="va">metodo</span>, color <span class="op">=</span> <span class="va">metodo</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Probabilidades estimadas"</span>,
       x <span class="op">=</span> <span class="st">"Edad"</span>,
       y <span class="op">=</span> <span class="st">"Probabilidad"</span>,
       col <span class="op">=</span> <span class="st">"Método anticonceptivo"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont036-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Qué conclusiones podemos extraer de este gráfico? ¿qué método predomina en el grupo de 20 a 24 años? ¿y en l grupo 40 a 44?</p>
</div>
</div>
<div id="respuesta-ordinal-predictora-nominal" class="section level3" number="15.4.4">
<h3>
<span class="header-section-number">15.4.4</span> Respuesta ordinal, predictora nominal<a class="anchor" aria-label="anchor" href="#respuesta-ordinal-predictora-nominal"><i class="fas fa-link"></i></a>
</h3>
<p>Cuando la variable respuesta tiene carácter ordinal el proceso de estimación debe variar para tener en cuenta dicho carácter. En esta situación no obtenemos los logit de una categoría con respecto a la de referencia sino que procedemos construyendo los logit de dos categorías consecutivas</p>
<p><span class="math display">\[log\left(\frac{\pi_{i+1|j}}{\pi_{i|j}}\right)\]</span></p>
<p>para valorar el incremento que sufre la probabilidad de un categoría con respecto a su categoría superior.</p>
<p>Para estimar dichos modelos debemos incluir una variable ficticia (<span class="math inline">\(S\)</span>) que contendrá los scores asociados con las categorías de la respuesta. Si <span class="math inline">\(u_1=1, u_2=2,...,u_n=n\)</span> denotan dichos scores y sólo tenemos una variable predictora, el logit anterior se puede obtener fácilmente mediante:</p>
<p><span class="math display">\[log(E(Y_{ij})) = \mu +\alpha_i + \beta_j + \theta_j S_i\]</span></p>
<p>donde <span class="math inline">\(\mu\)</span> es la interceptación del modelo, <span class="math inline">\(\alpha_i\)</span> es el efecto asociado con el nivel <span class="math inline">\(i\)</span> de la respuesta, <span class="math inline">\(\beta_j\)</span> es el efecto asociado con el nivel <span class="math inline">\(j\)</span> de la predictora, y <span class="math inline">\(\theta\)</span> es el efecto asociado con la variable de scores. En la práctica el logit para dos categorías consecutivas de la respuesta dependen únicamente de los coeficientes del modelo que afectaban a la respuesta y a la interacción entre respuesta y predictora, es decir:</p>
<p><span class="math display">\[log\left(\frac{\pi_{i+1|j}}{\pi_{i|j}}\right) = \eta_{i+1|j} =(\alpha_{i+1} - \alpha_i)+ \theta_j (u_{i+1} - u_i)\ \]</span></p>
<p>de forma que la relación entre ambas probabilidades viene dada por:</p>
<p><span class="math display">\[\frac{\pi_{i+1|j}}{\pi_{i|j}} = exp(\eta_{i+1|j}) = exp\{(\alpha_{i+1} - \alpha_i) + \theta_j (u_{i+1} - u_i)\}\]</span></p>
<p>Si queremos obtener la relación entre las probabilidades de las categorías <span class="math inline">\(i+2\)</span> e <span class="math inline">\(i\)</span> basta con considerar que:</p>
<p><span class="math display">\[\frac{\pi_{i+2|j}}{\pi_{i|j}} = \frac{\pi_{i+2|j}}{\pi_{i+1|j}}\frac{\pi_{i+1|j}}{\pi_{i|j}}\]</span>
que se puede calcular como:</p>
<p><span class="math display">\[\frac{\pi_{i+2|j}}{\pi_{i|j}} = exp(\eta_{i+2|j}) = exp\{(\alpha_{i+2} - \alpha_i) + \theta_j (u_{i+2} - u_i)\}\]</span></p>
<p>De esta forma podemos obtener la relación entre cualquier para de categorías de la respuesta.</p>
<div id="datos-de-gripe" class="section level4" number="15.4.4.1">
<h4>
<span class="header-section-number">15.4.4.1</span> Datos de gripe<a class="anchor" aria-label="anchor" href="#datos-de-gripe"><i class="fas fa-link"></i></a>
</h4>
<p>En primer lugar calculamos y evaluamos los logits empíricos asociados y más tarde realizamos el ajuste y estimación del modelo. Dado que la respuesta es ordinal debemos calcular los logits referenciados a la categoría inferior tomando como referencia inicial la categoría <code>small</code>. Obtenemos los log-odds y los representamos mediante:</p>
<div class="sourceCode" id="cb871"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creamos referencias de comparación consecutivas</span>
<span class="va">ref.val1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Gripe</span>, <span class="va">response</span> <span class="op">==</span> <span class="st">"small"</span><span class="op">)</span>, <span class="va">frequency</span><span class="op">)</span><span class="op">)</span>
<span class="va">ref.val2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Gripe</span>, <span class="va">response</span> <span class="op">==</span> <span class="st">"moderate"</span><span class="op">)</span>, <span class="va">frequency</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Log-odds</span>
<span class="va">Gripe</span> <span class="op">&lt;-</span> <span class="va">Gripe</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>referencia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">ref.val1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">ref.val2</span><span class="op">)</span>,
         lodds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">frequency</span> <span class="op">/</span> <span class="va">referencia</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="co"># Seleccionamos las categorías a representar eliminando la de referencia</span>
<span class="co"># Como la respuesta sólo tiene una categoría no hace falta utilizarla en el gráfico</span>
<span class="va">datos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Gripe</span>, <span class="va">response</span> <span class="op">!=</span> <span class="st">"small"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">lodds</span>, group <span class="op">=</span> <span class="va">response</span>, color <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Tratamiento"</span>,
       y <span class="op">=</span> <span class="st">"log-odds condicionados"</span>,
       col <span class="op">=</span> <span class="st">"Respuesta"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont037-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>Se observa casi un comportamiento paralelo entre los logits obtenidos. En este caso queremos estudiar un posible modelo de asociación entre la respuesta a la vacuna y el tipo de tratamiento seguido. La variable respuesta es de tipo ordinal y asignamos la variable de scores de 1 a 3, donde 1 refleja efecto pequeño y 3 refleja un efecto grande. En este caso modelizaremos los logits de categorías consecutivas: Moderado vs Pequeño, y Grande vs Moderado. Planteamos el análisis de independencia (sin interacción entre el tratamiento y la variable de scores) frente al de asociación (interacción entre tratamiento y scores) dado los logits observados.</p>
<p>En primer lugar creamos los scores asociados:</p>
<div class="sourceCode" id="cb872"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creamos variable de scores</span>
<span class="va">Gripe</span><span class="op">$</span><span class="va">efecto.s</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">Gripe</span><span class="op">$</span><span class="va">efecto.s</span><span class="op">[</span><span class="va">Gripe</span><span class="op">$</span><span class="va">response</span> <span class="op">==</span> <span class="st">"small"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">Gripe</span><span class="op">$</span><span class="va">efecto.s</span><span class="op">[</span><span class="va">Gripe</span><span class="op">$</span><span class="va">response</span> <span class="op">==</span> <span class="st">"moderate"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">Gripe</span><span class="op">$</span><span class="va">efecto.s</span><span class="op">[</span><span class="va">Gripe</span><span class="op">$</span><span class="va">response</span> <span class="op">==</span> <span class="st">"large"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span></code></pre></div>
<p>Ajustamos los modelos sin (independencia) y con interacción (dependencia) de los scores con la predictora y valoramos sin ambos modleos son iguales:</p>
<div class="sourceCode" id="cb873"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ajuste del modelo de independencia</span>
<span class="va">fit.gripe.ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frequency</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">response</span> <span class="op">+</span> <span class="va">efecto.s</span>, 
              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
              data <span class="op">=</span> <span class="va">Gripe</span><span class="op">)</span>
<span class="co"># Ajuste del modelo de asociación</span>
<span class="va">fit.gripe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frequency</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">response</span> <span class="op">+</span> <span class="va">treatment</span><span class="op">:</span><span class="va">efecto.s</span>, 
               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, 
               data <span class="op">=</span> <span class="va">Gripe</span><span class="op">)</span>
<span class="co"># Comparamos ambos modelos</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fit.gripe.ind</span>, <span class="va">fit.gripe</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: frequency ~ treatment + response + efecto.s
## Model 2: frequency ~ treatment + response + treatment:efecto.s
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1         2    18.6425                          
## 2         1     4.3106  1   14.332 0.0001532 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Rechazamos el modelo de independencia a favor del modelo de asociación. Veamos las estimaciones del modelo.</p>
<p>Obtenemos la tabla de estimación para el modelo:</p>
<div class="sourceCode" id="cb875"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">fit.gripe</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"term"</span>, <span class="st">"estimate"</span><span class="op">)</span><span class="op">]</span>
<span class="va">tabla</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   term                      estimate
##   &lt;chr&gt;                        &lt;dbl&gt;
## 1 (Intercept)                 4.88  
## 2 treatmentvaccine           -2.32  
## 3 responsemoderate            0.0928
## 4 responsesmall              -0.490 
## 5 treatmentplacebo:efecto.s  -1.25  
## 6 treatmentvaccine:efecto.s  NA</code></pre>
<p>Seleccionamos los efectos necesarios para el ajuste de los logits y la estimación de probabilidades. Estos efectos son los relacionados (principales e interacciones) con la variable <code>response</code>.</p>
<div class="sourceCode" id="cb877"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filas de la tabla de estimaciones relacionados con metodo</span>
<span class="va">tabla</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   term                      estimate
##   &lt;chr&gt;                        &lt;dbl&gt;
## 1 responsemoderate            0.0928
## 2 responsesmall              -0.490 
## 3 treatmentplacebo:efecto.s  -1.25</code></pre>
<p>Para este modelo Los logits consecutivos asociados vienen dados por las expresiones siguientes donde utilizamos la codificación <code>S = small</code>, <code>M = moderate</code>, y <code>L = large</code> para la variable response:</p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{M,j}}}{\pi_{\text{S,j}}}\right) = (\alpha_{\text{M}} - \alpha_{\text{S}}) + \theta_j(u_{M} - u_{S})\]</span>
<span class="math display">\[log\left(\frac{\pi_{\text{L,j}}}{\pi_{\text{M,j}}}\right) = (\alpha_{\text{L}} - \alpha_{\text{M}}) + \theta_j(u_{L} - u_{M})\]</span></p>
<p>donde los <span class="math inline">\(\alpha_i\)</span> son los efectos asociados con el nivel <span class="math inline">\(i\)</span> de la respuesta, <span class="math inline">\(\theta\)</span> es el efecto de intereacción entre predictora y scores, y los <span class="math inline">\(u_i\)</span> son los scores asociados con la variable respuesta. Al sustituir por las correspondientes estimaciones y scores proporciona:</p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{M,j}}}{\pi_{\text{S,j}}}\right) = (0.0928 + 0.490) + \theta_j (2 -1) = 0.5828 + \theta_j \]</span>
<span class="math display">\[log\left(\frac{\pi_{\text{L,j}}}{\pi_{\text{M,j}}}\right) = (0 - 0.0928) + \theta_j (3 - 2) = -0.0928 + \theta_j\]</span></p>
<p>con <span class="math inline">\(\theta_1 = -1.25\)</span> para el placebo y <span class="math inline">\(\theta_2 = 0\)</span> para el tratamiento. Si asignamos la codificación <code>T = treatment</code> y <code>P = placebo</code> los losgits obtenidos son:</p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{M,T}}}{\pi_{\text{S,T}}}\right) = 0.5828; \quad log\left(\frac{\pi_{\text{M,P}}}{\pi_{\text{S,P}}}\right) = - 0.6672\]</span>
<span class="math display">\[log\left(\frac{\pi_{\text{L,T}}}{\pi_{\text{M,T}}}\right)= - 0.0928; \quad log\left(\frac{\pi_{\text{L,P}}}{\pi_{\text{M,P}}}\right)= - 1.3428\]</span></p>
<p>A partir de estos logits podemos obtner las probabiliddes asociadas a cada combinación de respuesta y predictora. Calculamos y representamos dichas probabilidades:</p>
<div class="sourceCode" id="cb879"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculamos los conteos predichos del modelo</span>
<span class="va">conteos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.gripe</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="co"># Combinamos los datos originales con los predichos</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Gripe</span>, <span class="va">conteos</span><span class="op">)</span>
<span class="co"># Calculamos el conteo total por las predictoras</span>
<span class="va">newdata.sum</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>suma <span class="op">=</span> <span class="fu"><a href="https://www.mosaic-web.org/mosaic/reference/aggregating.html">sum</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Calculamos las probabilidades asociadas a cada combinación</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">newdata.sum</span>, by <span class="op">=</span> <span class="st">"treatment"</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">/</span><span class="va">suma</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Vemos las probabiliddes obtenidas</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">newdata</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">response</span>, <span class="va">prob</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   treatment response   prob
## 1   placebo    small 0.6075
## 2   placebo moderate 0.3113
## 3   placebo    large 0.0812
## 4   vaccine    small 0.2261
## 5   vaccine moderate 0.4049
## 6   vaccine    large 0.3690</code></pre>
<p>Podemos representar las probabilidades obtenidas para ver los efectos de la combinacion de predictoras en la respuesta.</p>
<div class="sourceCode" id="cb881"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">prob</span>, group <span class="op">=</span> <span class="va">response</span>, color <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Probabilidades estimadas"</span>,
       x <span class="op">=</span> <span class="st">"Tratamiento"</span>,
       y <span class="op">=</span> <span class="st">"Probabilidad"</span>,
       col <span class="op">=</span> <span class="st">"Respuesta"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont043-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Cómo varían las probabilidades de la respuesta en función del tratamiento?</p>
</div>
</div>
<div id="respuesta-ordinal-predictora-ordinal" class="section level3" number="15.4.5">
<h3>
<span class="header-section-number">15.4.5</span> Respuesta ordinal, predictora ordinal<a class="anchor" aria-label="anchor" href="#respuesta-ordinal-predictora-ordinal"><i class="fas fa-link"></i></a>
</h3>
<p>Imaginemos que tenemos una variable respuesta y otra predictora (ambas de carácter ordinal). La modelización en esta situación pasa por definir variables ficticias de scores tanto para la predictora como la respuesta. Denotamos por <span class="math inline">\(S\)</span> y <span class="math inline">\(U\)</span> a las variables de scores para la respuesta y la predictora respectivamente. Calculamos la variable producto <span class="math inline">\(P\)</span> en ambos scores que será introducida en el modelo para reflejar el posible efecto de interacción entre respuesta y predictora. En esta situación tenemos que:</p>
<p><span class="math display">\[log(E(Y_{ij})) = \mu +\alpha_i + \beta_j + \theta P_{ij} = \mu +\alpha_i + \beta_j + \theta S_iU_j\]</span>
donde <span class="math inline">\(\mu\)</span> es la interceptación del modelo, <span class="math inline">\(\alpha_i\)</span> es el efecto asociado con el nivel <span class="math inline">\(i\)</span> de la respuesta, <span class="math inline">\(\beta_j\)</span> es el efecto asociado con el nivel <span class="math inline">\(j\)</span> de la predictora, y <span class="math inline">\(\theta\)</span> es el efecto asociado con la variable <span class="math inline">\(P_{ij} = S_iU_j\)</span>. En la práctica se puede demostrar que el logit para dos categorías consecutivas de la respuesta dependen únicamente de los coeficientes del modelo que afectan a la respuesta y a la interacción entre respuesta y predictora, es decir:</p>
<p><span class="math display">\[log\left(\frac{\pi_{i+1|j}}{\pi_{i|j}}\right) = \eta_{i+1|j} = (\alpha_{i+1} - \alpha_i) + \theta (u_{i+1} - u_i)v_j\]</span></p>
<p>de forma que la relación entre ambas probabilidades viene dada por:</p>
<p><span class="math display">\[\frac{\pi_{i+1|j}}{\pi_{i|j}} = exp(\eta_{i+1|j}) = exp\{(\alpha_{i+1} - \alpha_i) + \theta (u_{i+1} - u_i)v_j\}\]</span></p>
<p>Si queremos obtener la relación entre las probabilidades de las categorías <span class="math inline">\(i+2\)</span> e <span class="math inline">\(i\)</span> basta con considerar que:</p>
<p><span class="math display">\[\frac{\pi_{i+2|j}}{\pi_{i|j}} = \frac{\pi_{i+2|j}}{\pi_{i+1|j}}\frac{\pi_{i+1|j}}{\pi_{i|j}}\]</span></p>
<p>que se puede calcular como:</p>
<p><span class="math display">\[\frac{\pi_{i+2|j}}{\pi_{i|j}} = exp(\eta_{i+2|j}) = exp\{(\alpha_{i+2} - \alpha_i) + \theta (u_{i+2} - u_i)v_j\}\]</span></p>
<p>De esta forma podemos obtener la relación entre cualquier par de categorías de la respuesta. Actuado de esta forma resulta posible calcular la probabilidad de cada categoría de la respuesta sin más que fijar una categoría de referencia, y obtener todas las probabilidades asociadas con la de referencia. Procederíamos entonces como en el caso multinomial.</p>
<p>Todas estas ecuaciones de estimación se pueden generalizar sin problemas cuando existe más de una variable predictora, sin más que considerar las posibles interacciones entre la respuesta y las predictoras. En caso de tratarse de variables de tipo ordinal construiremos los scores correspondientes para analizar dichos efectos de interacción.</p>
<div id="datos-satisfacción-laboral" class="section level4" number="15.4.5.1">
<h4>
<span class="header-section-number">15.4.5.1</span> Datos Satisfacción laboral<a class="anchor" aria-label="anchor" href="#datos-satisfacci%C3%B3n-laboral"><i class="fas fa-link"></i></a>
</h4>
<p>Si tomamos como variable respuesta el grado de satisfacción, y usamos como referencia la categroria <code>Muy Insatisfecho</code> podemos obtener los log-odds condicionales mediante:</p>
<div class="sourceCode" id="cb882"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creamos referencias de comparación consecutivas</span>
<span class="va">ref.val1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Satisfaccion</span>, <span class="va">Estado</span> <span class="op">==</span> <span class="st">"Muy insatisfecho"</span><span class="op">)</span>,<span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span>
<span class="va">ref.val2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Satisfaccion</span>, <span class="va">Estado</span> <span class="op">==</span> <span class="st">"Poco insatisfecho"</span><span class="op">)</span>,<span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span>
<span class="va">ref.val3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Satisfaccion</span>, <span class="va">Estado</span> <span class="op">==</span> <span class="st">"Moderadamente satisfecho"</span><span class="op">)</span>, <span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Log-odds</span>
<span class="va">Satisfaccion</span> <span class="op">&lt;-</span> <span class="va">Satisfaccion</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>referencia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">ref.val1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">ref.val2</span>, <span class="va">ref.val3</span><span class="op">)</span>,
         lodds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">/</span> <span class="va">referencia</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico</span>
<span class="co"># Seleccionamos las categorías a representar eliminando la de referencia</span>
<span class="co"># Como la respuesta sólo tiene una categoría no hace falta utilizarla en el gráfico</span>
<span class="va">datos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Satisfaccion</span>, <span class="va">Estado</span> <span class="op">!=</span> <span class="st">"Muy insatisfecho"</span><span class="op">)</span>
<span class="va">ords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 6000"</span>, <span class="st">"6000 - 15000"</span>, <span class="st">"15000 - 25000"</span>, <span class="st">"&gt; 25000"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">datos</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Ingresos</span>, y <span class="op">=</span> <span class="va">lodds</span>, group <span class="op">=</span> <span class="va">Estado</span>, color <span class="op">=</span> <span class="va">Estado</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">ords</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Ingresos"</span>,
       y <span class="op">=</span> <span class="st">"log-odds condicionados"</span>,
       col <span class="op">=</span> <span class="st">"Grado de satisfacción"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont044-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Cómo interpretamos los log-odds condicionales entre categorías consecutivas obtenidos? Recuerda que en este caso cada perfil se debe comparar con la categoria inmediatamente inferior.</p>
<p>En este caso queremos estudiar un posible modelo de asociación entre la satisfacción laboral en función de los ingresos percibidos. Tanto la variable respuesta como la predictora se encuentran en escala ordinal. Debemos introducir los scores asociados a ambas variables para poder considerarlos en el modelo de asociación. Creamos scores en escala continua de 1 a 4 para la satisfacción (<span class="math inline">\(u_i\)</span>), y de 1 a 4 para los ingresos (<span class="math inline">\(v_j\)</span>), ya que los intervalos considerados no tienen la misma amplitud en este caso y no podmeos utilizar el punto medio. La interacción entre ambas variables se reflejará mediante el producto de las variables de scores creadas.</p>
<div class="sourceCode" id="cb883"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generamos la variable de interacción</span>
<span class="va">Satisfaccion</span> <span class="op">&lt;-</span> <span class="va">Satisfaccion</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>asociacion <span class="op">=</span> <span class="va">Ingresos.num</span> <span class="op">*</span> <span class="va">Estado.num</span><span class="op">)</span>
<span class="co"># Ajuste del modelo de independencia</span>
<span class="va">fit.satisfaccion.ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">Ingresos</span> <span class="op">+</span> <span class="va">Estado</span>, 
              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">Satisfaccion</span><span class="op">)</span>
<span class="co"># Ajuste del modelo de asociación</span>
<span class="va">fit.satisfaccion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">frecuencia</span> <span class="op">~</span> <span class="va">Ingresos</span> <span class="op">+</span> <span class="va">Estado</span> <span class="op">+</span> <span class="va">asociacion</span>, 
               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dobson/man/poisson.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">Satisfaccion</span><span class="op">)</span>
<span class="co"># Comparamos ambos modelos</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fit.satisfaccion.ind</span>, <span class="va">fit.satisfaccion</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: frecuencia ~ Ingresos + Estado
## Model 2: frecuencia ~ Ingresos + Estado + asociacion
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)   
## 1         9    12.0369                        
## 2         8     2.3859  1   9.6509 0.001893 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Rechazamos el modelo de independencia a favor del modelo de asociación que obtenemos con los scores. Veamos el resumen del modelo:</p>
<div class="sourceCode" id="cb885"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">fit.satisfaccion</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"term"</span>, <span class="st">"estimate"</span><span class="op">)</span><span class="op">]</span>
<span class="va">tabla</span></code></pre></div>
<pre><code>## # A tibble: 8 × 2
##   term                    estimate
##   &lt;chr&gt;                      &lt;dbl&gt;
## 1 (Intercept)               3.98  
## 2 Ingresos&gt; 25000          -1.26  
## 3 Ingresos15000 - 25000    -0.577 
## 4 Ingresos6000 - 15000     -0.0105
## 5 EstadoMuy insatisfecho   -1.13  
## 6 EstadoMuy satisfecho     -0.0181
## 7 EstadoPoco insatisfecho  -0.823 
## 8 asociacion                0.112</code></pre>
<p>Seleccionamos los efectos necesarios para el ajuste de los logits y la estimación de probabilidades. Estos efectos son los relacionados (principales e interacciones) con la variable <code>Estado</code>.</p>
<div class="sourceCode" id="cb887"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filas de la tabla de estimaciones relacionados con metodo</span>
<span class="va">tabla</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>,<span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   term                    estimate
##   &lt;chr&gt;                      &lt;dbl&gt;
## 1 EstadoMuy insatisfecho   -1.13  
## 2 EstadoMuy satisfecho     -0.0181
## 3 EstadoPoco insatisfecho  -0.823 
## 4 asociacion                0.112</code></pre>
<p>Para la obtención de los logits vinculados con este modelo usamos la codificación <code>Muy Insatisfecho = S1</code>, <code>Poco Insatisfecho = S2</code>, <code>Moderadamente Satisfecho = S3</code>, y <code>Muy Satisfecho = S4</code> para la variable Estado, y <code>&lt; 6000 = I1</code>, <code>6000 - 15000 = I2</code>, <code>15000 - 25000 = I3</code>, y <code>&gt; 25000 = I4</code> para la variable ingresos, de forma que las ecuaciones de los logit para este modelo vienen dadas por:</p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{S4|j}}}{\pi_{\text{S3|j}}}\right) = (\alpha_{\text{S4|j}} - \alpha_{\text{S3|j}} ) + \theta (u_{\text{S4|j}} - u_{\text{S3|j}})v_j\]</span></p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{S3|j}}}{\pi_{\text{S2|j}}}\right) = (\alpha_{\text{S3|j}} - \alpha_{\text{S2|j}} ) + \theta (u_{\text{S3|j}} - u_{\text{S2|j}})v_j\]</span></p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{S2|j}}}{\pi_{\text{S1|j}}}\right) = (\alpha_{\text{S2|j}} - \alpha_{\text{S1|j}} ) + \theta (u_{\text{S2|j}} - u_{\text{S1|j}})v_j\]</span></p>
<p>donde los <span class="math inline">\(\alpha_i\)</span> son los efectos asociados con el nivel <span class="math inline">\(i\)</span> de la respuesta, <span class="math inline">\(\theta\)</span> es el efecto de intereacción entre scores (<code>asociacion</code>), los <span class="math inline">\(u_i\)</span> son los scores asociados con <code>Estado</code>, y los <span class="math inline">\(u_i\)</span> son los scores asociados con <code>Ingresos</code>. Al sustituir por las correspondientes estimaciones y scores proporciona:</p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{S4|j}}}{\pi_{\text{S3|j}}}\right) = (-0.0181 - 0) + 0.112*(4-3)* v_j = -0.0181 + 0.112 * v_j\]</span></p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{S3|j}}}{\pi_{\text{S2|j}}}\right) = (0 + 0.823) + 0.112*(3-2)* v_j = 0.823 + 0.112 * v_j\]</span></p>
<p><span class="math display">\[log\left(\frac{\pi_{\text{S2|j}}}{\pi_{\text{S1|j}}}\right) = (-0.823 + 1.13) + 0.112*(2-1)* v_j = 0.307 + 0.112 * v_j\]</span></p>
<p>Sustiyuendo los <span class="math inline">\(v_j\)</span> podemos establecer la relación entre las probabildiades de dos categorias consecutivas de la respuesta. Finalmente obtnemos las probabilidades asociadas al modelo ajustado.</p>
<div class="sourceCode" id="cb889"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculamos los conteos predichos del modelo</span>
<span class="va">conteos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.satisfaccion</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="co"># Combinamos los datos originales con los predichos</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Satisfaccion</span>, <span class="va">conteos</span><span class="op">)</span>
<span class="co"># Calculamos el conteo total por las predictoras</span>
<span class="va">newdata.sum</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Ingresos</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>suma <span class="op">=</span> <span class="fu"><a href="https://www.mosaic-web.org/mosaic/reference/aggregating.html">sum</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Calculamos las probabilidades asociadas a cada combinación</span>
<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="va">newdata</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">newdata.sum</span>, by <span class="op">=</span> <span class="st">"Ingresos"</span><span class="op">)</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">conteos</span><span class="op">/</span><span class="va">suma</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Vemos las probabiliddes obtenidas</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">newdata</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Ingresos</span>, <span class="va">Estado</span>, <span class="va">prob</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##         Ingresos                   Estado   prob
## 1         &lt; 6000         Muy insatisfecho 0.0939
## 2   6000 - 15000         Muy insatisfecho 0.0741
## 3  15000 - 25000         Muy insatisfecho 0.0578
## 4        &gt; 25000         Muy insatisfecho 0.0447
## 5         &lt; 6000        Poco insatisfecho 0.1429
## 6   6000 - 15000        Poco insatisfecho 0.1261
## 7  15000 - 25000        Poco insatisfecho 0.1101
## 8        &gt; 25000        Poco insatisfecho 0.0952
## 9         &lt; 6000 Moderadamente satisfecho 0.3637
## 10  6000 - 15000 Moderadamente satisfecho 0.3589
## 11 15000 - 25000 Moderadamente satisfecho 0.3505
## 12       &gt; 25000 Moderadamente satisfecho 0.3390
## 13        &lt; 6000           Muy satisfecho 0.3995
## 14  6000 - 15000           Muy satisfecho 0.4409
## 15 15000 - 25000           Muy satisfecho 0.4816
## 16       &gt; 25000           Muy satisfecho 0.5210</code></pre>
<p>Podemos representar las probabilidades obtenidas para ver los efectos de la combinacion de predictoras en la respuesta.</p>
<div class="sourceCode" id="cb891"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 6000"</span>, <span class="st">"6000 - 15000"</span>, <span class="st">"15000 - 25000"</span>, <span class="st">"&gt; 25000"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Ingresos</span>, y <span class="op">=</span> <span class="va">prob</span>, group <span class="op">=</span> <span class="va">Estado</span>, color <span class="op">=</span> <span class="va">Estado</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">ords</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Probabilidades estimadas"</span>,
       x <span class="op">=</span> <span class="st">"Ingresos"</span>,
       y <span class="op">=</span> <span class="st">"Probabilidad"</span>,
       col <span class="op">=</span> <span class="st">"Nivel de satisfacción"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont049-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Cómo evolucionan las probabilidades del nivel de satisfacción en función de los ingresos percibidos?</p>
</div>
</div>
</div>
<div id="diagnóstico-6" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> Diagnóstico<a class="anchor" aria-label="anchor" href="#diagn%C3%B3stico-6"><i class="fas fa-link"></i></a>
</h2>
<p>El diagnóstico de este tipo de modelos se parece al diagnóstico de los modelos de poisson. Dado que sólo tenemos un valor predicho y un residuo por cada combinación de niveles el diagnóstico nos limitaremos a:</p>
<ul>
<li>Realizar el gráfico de residuos vs ajustados del predictor lineal, para detectar problema de linealidad y/o homogeneidad.<br>
</li>
<li>Realizar el gráfico de valores predichos (frecuencias predichas) vs observados (frecuenias observadas), para conocer la precisión en la predicción de la frecuencia de interés.</li>
</ul>
<p>A continuación pasamos a analizar los ejemplos tratados en el punto anterior.</p>
<div id="ejemplos-22" class="section level3" number="15.5.1">
<h3>
<span class="header-section-number">15.5.1</span> Ejemplos<a class="anchor" aria-label="anchor" href="#ejemplos-22"><i class="fas fa-link"></i></a>
</h3>
<p>Para el análisis diagnóstico utilizamos la función <code>fortify</code> que nos proporciona tanto los valores de predicción del preditor lineal y los residuos estandarizados, mientras que la predicción de la respuesta ya hemos visto en el punto anterior como obtenerla como una nueva columna denominada <code>conteos</code>.</p>
<div id="aspirina-2" class="section level4" number="15.5.1.1">
<h4>
<span class="header-section-number">15.5.1.1</span> Aspirina<a class="anchor" aria-label="anchor" href="#aspirina-2"><i class="fas fa-link"></i></a>
</h4>
<p>En primer luagr realizamos el gráfico de residuos versus ajustados (predictor lineal).</p>
<div class="sourceCode" id="cb892"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores de diganóstico</span>
<span class="va">diagnostico</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op">(</span><span class="va">fit.aspirina</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diagnostico</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">.fitted</span>, <span class="va">.stdresid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Ajustados"</span>, y <span class="op">=</span> <span class="st">"Residuos"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure">
<img src="14-GLMTablasCont_files/figure-html/tcont050-1.png" width="95%" style="display: block; margin: auto;">
Dado que hay tan pocas observaciones resulta díficl poder concluir que existe algún problema con las hipótesis del modelo.</div>
<p>Comprobamos la bondad del modelo representando los valores originales de frecuencias frente a los valores ajustados.</p>
<div class="sourceCode" id="cb893"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores predichos</span>
<span class="va">Aspirina</span> <span class="op">&lt;-</span> <span class="va">Aspirina</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>conteo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.aspirina</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Aspirina</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">conteo</span>, <span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicción frecuencia"</span>, y <span class="op">=</span> <span class="st">"Frecuencia observada"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont051-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>El ajuste conseguido es bastante bueno dado que los valores se presentan a los largo de la diagonal, que representa el ajuste perfecto.</p>
</div>
<div id="aspiraciones-2" class="section level4" number="15.5.1.2">
<h4>
<span class="header-section-number">15.5.1.2</span> Aspiraciones<a class="anchor" aria-label="anchor" href="#aspiraciones-2"><i class="fas fa-link"></i></a>
</h4>
<p>En primer luagr realizamos el gráfico de residuos versus ajustados (predictor lineal).</p>
<div class="sourceCode" id="cb894"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores de diganóstico</span>
<span class="va">diagnostico</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op">(</span><span class="va">fit.aspiraciones</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diagnostico</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">.fitted</span>, <span class="va">.stdresid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Ajustados"</span>, y <span class="op">=</span> <span class="st">"Residuos"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure">
<img src="14-GLMTablasCont_files/figure-html/tcont052-1.png" width="95%" style="display: block; margin: auto;">
Parece intuirse que existe una mayor variabilidad conforme aumenta el valor ajustado pero no resulta muy concluyente.</div>
<p>Comprobamos la bondad del modelo representando los valores originales de frecuencias frente a los valores ajustados.</p>
<div class="sourceCode" id="cb895"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores predichos</span>
<span class="va">Aspiraciones</span> <span class="op">&lt;-</span> <span class="va">Aspiraciones</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>conteo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.aspiraciones</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Aspiraciones</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">conteo</span>, <span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicción frecuencia"</span>, y <span class="op">=</span> <span class="st">"Frecuencia observada"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont053-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>El ajuste conseguido es bastante bueno dado que los valores se presentan a los largo de la diagonal, que representa el ajuste perfecto.</p>
</div>
<div id="contraceptivos-1" class="section level4" number="15.5.1.3">
<h4>
<span class="header-section-number">15.5.1.3</span> Contraceptivos<a class="anchor" aria-label="anchor" href="#contraceptivos-1"><i class="fas fa-link"></i></a>
</h4>
<p>En primer luagr realizamos el gráfico de residuos versus ajustados (predictor lineal).</p>
<div class="sourceCode" id="cb896"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores de diganóstico</span>
<span class="va">diagnostico</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op">(</span><span class="va">fit.contraceptivos</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diagnostico</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">.fitted</span>, <span class="va">.stdresid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Ajustados"</span>, y <span class="op">=</span> <span class="st">"Residuos"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont054-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Qué opinas sobre el gráfico?</p>
<p>Comprobamos la bondad del modelo representando los valores originales de frecuencias frente a los valores ajustados.</p>
<div class="sourceCode" id="cb897"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores predichos</span>
<span class="va">Contraceptivos</span> <span class="op">&lt;-</span> <span class="va">Contraceptivos</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>conteo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.contraceptivos</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Contraceptivos</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">conteo</span>, <span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicción frecuencia"</span>, y <span class="op">=</span> <span class="st">"Frecuencia observada"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont055-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>El ajuste conseguido es bastante bueno dado que los valores se presentan a los largo de la diagonal, que representa el ajuste perfecto.</p>
</div>
<div id="gripe-2" class="section level4" number="15.5.1.4">
<h4>
<span class="header-section-number">15.5.1.4</span> Gripe<a class="anchor" aria-label="anchor" href="#gripe-2"><i class="fas fa-link"></i></a>
</h4>
<p>En primer luagr realizamos el gráfico de residuos versus ajustados (predictor lineal).</p>
<div class="sourceCode" id="cb898"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores de diganóstico</span>
<span class="va">diagnostico</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op">(</span><span class="va">fit.gripe</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diagnostico</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">.fitted</span>, <span class="va">.stdresid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Ajustados"</span>, y <span class="op">=</span> <span class="st">"Residuos"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure">
<img src="14-GLMTablasCont_files/figure-html/tcont056-1.png" width="95%" style="display: block; margin: auto;">
¿Qué opinas sobre el gráfico?</div>
<p>Comprobamos la bondad del modelo representando los valores originales de frecuencias frente a los valores ajustados.</p>
<div class="sourceCode" id="cb899"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores predichos</span>
<span class="va">Gripe</span> <span class="op">&lt;-</span> <span class="va">Gripe</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>conteo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.gripe</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Gripe</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">conteo</span>, <span class="va">frequency</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicción frecuencia"</span>, y <span class="op">=</span> <span class="st">"Frecuencia observada"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont057-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Qué opinas de la calidad del ajuste?</p>
</div>
<div id="satisfacción-laboral-1" class="section level4" number="15.5.1.5">
<h4>
<span class="header-section-number">15.5.1.5</span> Satisfacción laboral<a class="anchor" aria-label="anchor" href="#satisfacci%C3%B3n-laboral-1"><i class="fas fa-link"></i></a>
</h4>
<p>En primer lugar realizamos el gráfico de residuos versus ajustados (predictor lineal).</p>
<div class="sourceCode" id="cb900"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores de diganóstico</span>
<span class="va">diagnostico</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op">(</span><span class="va">fit.satisfaccion</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diagnostico</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">.fitted</span>, <span class="va">.stdresid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Ajustados"</span>, y <span class="op">=</span> <span class="st">"Residuos"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure">
<img src="14-GLMTablasCont_files/figure-html/tcont058-1.png" width="95%" style="display: block; margin: auto;">
¿Qué opinas sobre el gráfico?</div>
<p>Comprobamos la bondad del modelo representando los valores originales de frecuencias frente a los valores ajustados.</p>
<div class="sourceCode" id="cb901"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Valores predichos</span>
<span class="va">Satisfaccion</span> <span class="op">&lt;-</span> <span class="va">Satisfaccion</span> <span class="op"><a href="https://stringr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>conteo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.satisfaccion</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Gráfico Residuos vs ajustados</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Satisfaccion</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">conteo</span>, <span class="va">frecuencia</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicción frecuencia"</span>, y <span class="op">=</span> <span class="st">"Frecuencia observada"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="14-GLMTablasCont_files/figure-html/tcont059-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>¿Qué opinas de la calidad del ajuste?</p>
</div>
</div>
</div>
<div id="predicción-6" class="section level2" number="15.6">
<h2>
<span class="header-section-number">15.6</span> Predicción<a class="anchor" aria-label="anchor" href="#predicci%C3%B3n-6"><i class="fas fa-link"></i></a>
</h2>
<p>La predicción en este tipo de modelos pasa por estimar:</p>
<ul>
<li>los conteos predichos para comninación de variables incluidas en el modelo,</li>
<li>las probabilidades de ocurrencia de cada combinación.</li>
</ul>
<p>Dado que en puntos anteriores ya hemos visto como obtener dichos valores de interés no repetoremos de nuevo dichos calculos.</p>
</div>
<div id="ejercicios-5" class="section level2" number="15.7">
<h2>
<span class="header-section-number">15.7</span> Ejercicios<a class="anchor" aria-label="anchor" href="#ejercicios-5"><i class="fas fa-link"></i></a>
</h2>
<p>Colección de ejercicios sobre modleos lineales generalizados con respuesta binomial. Los pasos a seguir para la obtención del modelo son los que hemos ido desarrollando: representación gráfica y propuesta de modelo, ajuste, bondad de ajuste, diagnóstico y predicción. En caso de encontrar problemas con el diagnóstico se deberá proponer un nuevo modelo alternativo.</p>
<p><em>No olvides cargar las librerías para realizar los ejercicios.</em></p>
<p><strong>Ejercicio 1.</strong> En el banco de datos siguiente aparecen los datos de un estudio sobre la actividad sexual de los adolescentes entre 15 y 16 años. El objetivo básico de interés radica en conocer si han tenido o no relaciones sexuales. Las datos son el número de adolescentes (<code>frecuencia</code>) que han tenido o no relaciones sexuales (<code>relaciones</code>) en función del sexo del adolescente (<code>sexo</code>) y su raza (<code>raza</code>). Realiza un análisis preliminar de los datos recogidos y contesta a las siguientes preguntas ajustando el modelo que corresponda en cada caso:</p>
<ul>
<li>¿Hay diferencias entre individuos de raza blanca y de raza negra respecto al hecho de haber tenido relaciones sexuales antes de los 16 años? ¿Y entre chicos y chicas?</li>
<li>Predice la proporción de individuos que han tenido relaciones sexuales antes de los 16 años en función de su sexo y raza.</li>
</ul>
<div class="sourceCode" id="cb902"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raza</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Blanca"</span>, <span class="st">"Negra"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sexo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">8</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hombre"</span>, <span class="st">"Mujer"</span><span class="op">)</span><span class="op">)</span> 
<span class="va">relaciones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">8</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Si"</span>, <span class="st">"No"</span><span class="op">)</span><span class="op">)</span>
<span class="va">frecuencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">43</span>, <span class="fl">134</span>, <span class="fl">26</span>, <span class="fl">149</span>, <span class="fl">29</span>, <span class="fl">23</span>, <span class="fl">22</span>, <span class="fl">36</span><span class="op">)</span>
<span class="va">ejercicio01</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">raza</span>, <span class="va">sexo</span>, <span class="va">relaciones</span>, <span class="va">frecuencia</span><span class="op">)</span></code></pre></div>
<p><strong>Ejercicio 2.</strong> Los datos que se presentan corresponden a una encuesta social en Dinamarca, en la que se clasificó a 165 individuos según su estatus marital (soltero, casado, o divorciado alguna vez} y su edad. Se pretendía establecer una relación entre las variables estatus marital y edad, con el fin de concluir sobre el comportamiento social en Dinamarca.</p>
<ul>
<li>Identifica las variables involucradas en el análisis de estos datos. ¿Cuáles son de tipo cualitativo -nominal u ordinal- y cuáles cuantitativas?</li>
<li>A la vista de los datos y del gráfico de número de individuos versus edad para cada status marital, ¿aprecias algún tipo de tendencia entre edad y estatus marital? El efecto de la edad, ¿es similar para los solteros, los casados y los divorciados?</li>
<li>¿Existe alguna relación entre el estatus marital y la edad? Tu conclusión, ¿es coherente con lo que comentaste en el apartado anterior?</li>
<li>Si pretendemos llevar a cabo un análisis predictivo y explicar la proporción de individuos en cada uno de los estatus maritales en función de la edad, ¿cuál es la variable a explicar y cuál la explicativa? Incorporando toda la información de que dispones. propón. formula y ajusta un modelo log-lineal útil para concluir sobre la relación entre edad y estatus marital. Comenta las hipótesis que asumes y tus conclusiones.</li>
<li>Construye la variable log(edad-16)y y representa el gráfico del punto 2 para esta nueva variable (sustituyendo la variable edad). Ajusta el modelo log-lineal más acertado para representar dicha información. Extrae las conclusiones de dicho modelo.</li>
<li>Compara las probabilidades condicionadas de estatus dado edad para el modelo anterior. Para el grupo de edad 40-50, ¿cuál es la relación que predices entre las proporciones de individuos en cada estatus marital? ¿Qué es lo más común en ese grupo de edad?</li>
</ul>
<div class="sourceCode" id="cb903"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">edad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">3</span>, <span class="fl">24</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"17-21"</span>, <span class="st">"21-25"</span>, <span class="st">"25-30"</span>, <span class="st">"30-40"</span>, 
                                <span class="st">"40-50"</span>, <span class="st">"50-60"</span>, <span class="st">"60-70"</span>, <span class="st">"+70"</span><span class="op">)</span><span class="op">)</span>
<span class="va">estado</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">24</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Solteros"</span>, <span class="st">"Casados"</span>, <span class="st">"Divorciados"</span><span class="op">)</span><span class="op">)</span>
<span class="va">frecuencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">16</span>, <span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">8</span>, <span class="fl">17</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">22</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">21</span>, 
                <span class="fl">6</span>, <span class="fl">3</span>, <span class="fl">17</span>, <span class="fl">8</span>, <span class="fl">2</span>, <span class="fl">8</span>, <span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">edad.num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">23</span>, <span class="fl">27.5</span>, <span class="fl">35</span>, <span class="fl">45</span>, <span class="fl">55</span>, <span class="fl">65</span>, <span class="fl">75</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">ejercicio02</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edad</span>, <span class="va">estado</span>, <span class="va">frecuencia</span>, <span class="va">edad.num</span><span class="op">)</span></code></pre></div>
<p><strong>Ejercicio 3.</strong> Los datos que se presentan corresponden al status de supervivencia, tras tres años, de pacientes con cáncer de mama, clasificados por su edad (en tres grupos) y por el tipo de tumor (maligno o benigno). Formula al menos dos preguntas de interés científico para contestar a partir de los datos anteriores.</p>
<ul>
<li>Formula el modelo a ajustar suponiendo que existe independencia completa entre los tres factores de clasificación. Contrasta la hipótesis de independencia completa.</li>
<li>Formula el modelo correspondiente a la hipótesis de que el que una paciente sobreviva no tiene nada que ver con su edad o con el tipo de tumor que padece, y resuelve el contraste.</li>
<li>Formula el modelo correspondiente a la hipótesis de que en cada grupo de edad, el que una paciente sobreviva o no es independiente del tipo de tumor, y resuelve el contraste.</li>
<li>Consigue el mejor ajuste para explicar los datos de supervivencia al cáncer de mama. Justifícalo y formula explícitamente el modelo que has ajustado.</li>
<li>¿Cómo están relacionados la supervivencia de una paciente, con su edad y con el tipo de tumor que padece? Identifica los coeficientes que explican dicha relación.</li>
<li>Según el modelo que has ajustado, calcula el número de pacientes que se espera que sobrevivan en función del grupo de edad al que pertenecen y el tipo de tumor que padecen.</li>
</ul>
<div class="sourceCode" id="cb904"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">edad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">12</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;50"</span>, <span class="st">"50-69"</span>, <span class="st">"&gt;70"</span><span class="op">)</span><span class="op">)</span>
<span class="va">maligno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">12</span>,labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"No"</span>, <span class="st">"Si"</span><span class="op">)</span><span class="op">)</span>
<span class="va">supervivencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">12</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Si"</span>, <span class="st">"No"</span><span class="op">)</span><span class="op">)</span>
<span class="va">frecuencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">77</span>, <span class="fl">51</span>, <span class="fl">51</span>, <span class="fl">38</span>, <span class="fl">7</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">13</span>, <span class="fl">11</span>, <span class="fl">20</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">edad.num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">80</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">80</span><span class="op">)</span>
<span class="va">ejercicio03</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edad</span>, <span class="va">maligno</span>, <span class="va">supervivencia</span>, 
                          <span class="va">frecuencia</span>, <span class="va">edad.num</span><span class="op">)</span></code></pre></div>
<p><strong>Ejercicio 4.</strong> En la Fiji Fertility Survey de 1975 se entrevistó a 1607 mujeres casadas y embarazadas. Fueron clasificadas por edad actual (4 grupos), nivel de estudios (2 niveles), deseo de tener más hijos y uso de contraceptivos. ¿Están relacionados factores como la educación, la edad o simplemente el deseo de no tener más hijos, con el uso de contraceptivos?</p>
<div class="sourceCode" id="cb905"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">edad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">32</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;25"</span>, <span class="st">"25-29"</span>, <span class="st">"30-39"</span>, <span class="st">"40-49"</span><span class="op">)</span><span class="op">)</span>
<span class="va">estudios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">32</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Baja"</span>, <span class="st">"Alta"</span><span class="op">)</span><span class="op">)</span>
<span class="va">hijos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">32</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Si"</span>, <span class="st">"No"</span><span class="op">)</span><span class="op">)</span>
<span class="va">contraceptivos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">16</span>, <span class="fl">32</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Si"</span>, <span class="st">"No"</span><span class="op">)</span><span class="op">)</span>
<span class="va">frecuencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">53</span>, <span class="fl">10</span>, <span class="fl">212</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">19</span>, <span class="fl">155</span>, <span class="fl">65</span>, <span class="fl">112</span>, <span class="fl">77</span>, <span class="fl">118</span>, 
                <span class="fl">68</span>, <span class="fl">35</span>, <span class="fl">46</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">52</span>, <span class="fl">10</span>, <span class="fl">14</span>, <span class="fl">10</span>, <span class="fl">54</span>, <span class="fl">27</span>, 
                <span class="fl">33</span>, <span class="fl">80</span>, <span class="fl">46</span>, <span class="fl">78</span>, <span class="fl">6</span>, <span class="fl">48</span>, <span class="fl">8</span>, <span class="fl">31</span><span class="op">)</span>
<span class="va">edad.num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">22.5</span>, <span class="fl">27.5</span>, <span class="fl">35</span>, <span class="fl">45</span>, <span class="fl">22.5</span>, <span class="fl">27.5</span>, <span class="fl">35</span>, <span class="fl">45</span><span class="op">)</span>, 
                <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">ejercicio04</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">edad</span>, <span class="va">estudios</span>, <span class="va">hijos</span>, <span class="va">contraceptivos</span>, 
                          <span class="va">frecuencia</span>, <span class="va">edad.num</span><span class="op">)</span></code></pre></div>
<p><strong>Ejercicio 5.</strong> En el banco de datos siguiente recoge la información de un estudio sobre la vinculación del cáncer de pulmón y el consumo de tabaco. Se registra la información de hombres ingresados en hospitales enfermos de cáncer de pulmón y enfermos por otras causas (controles) y se les preguntó sobre su consumo diario de cigarros. ¿Existe relación entre el consumo de cigarros y tener cáncer de pulmón? Si es así ¿cómo cambia la probabilidad de tener cáncer de pulmón en función del consumo diario de cigarros?</p>
<div class="sourceCode" id="cb906"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">consumo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">12</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ninguno"</span>, <span class="st">"&lt;5"</span>, <span class="st">"5-14"</span>, 
                                   <span class="st">"15-24"</span>, <span class="st">"25-49"</span>, <span class="st">"50+"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sujeto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">12</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cáncer"</span>, <span class="st">"control"</span><span class="op">)</span><span class="op">)</span>
<span class="va">frecuencia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">55</span>, <span class="fl">489</span>, <span class="fl">475</span>, <span class="fl">293</span>, <span class="fl">38</span>, <span class="fl">61</span>, <span class="fl">129</span>, <span class="fl">570</span>, 
                <span class="fl">431</span>, <span class="fl">154</span>, <span class="fl">12</span><span class="op">)</span>
<span class="va">edad.num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">9.5</span>, <span class="fl">19.5</span>, <span class="fl">37</span>, <span class="fl">55</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">ejercicio05</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">consumo</span>, <span class="va">sujeto</span>, <span class="va">frecuencia</span>, <span class="va">edad.num</span><span class="op">)</span></code></pre></div>
<p><strong>Ejercicio 6.</strong> En el banco de datos siguiente recoge la información de un estudio sobre el estudio de cierta sustancia farmacológica que potencialmente podría acarrear malformaciones en el feto. Para ello se toma una muestra de ratones embarazados, se les aplica diferente concentraciones de fármaco y se observan los resultados tras el embarazo (“Muerto”, “Malformaciones”,“Normal”). La concentración, medida en mg/kg por día, tiene los niveles: “N0” = 0, “N1” = 62.5, “N2” = 125, “N3” = 250, “N4” = 500. ¿Influye la concentración en las características finales del feto? Si utilizamos los valores numéricos de concentración ¿Como varía el estado del feto en función de dicha concentración?</p>
<div class="sourceCode" id="cb907"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">concentracion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">5</span> ,<span class="fl">1</span>, <span class="fl">15</span>,labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"N0"</span>, <span class="st">"N1"</span>, <span class="st">"N2"</span>, <span class="st">"N3"</span>, <span class="st">"N4"</span><span class="op">)</span><span class="op">)</span>
<span class="va">concentracion.num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">62.5</span>, <span class="fl">125</span>, <span class="fl">250</span>, <span class="fl">500</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">estado</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/gl.html">gl</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">15</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Muerto"</span>, <span class="st">"Malformaciones"</span>, <span class="st">"Normal"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ejercicio06</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">concentracion</span>, <span class="va">concentracion.num</span>, <span class="va">estado</span><span class="op">)</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="glmpoisson.html"><span class="header-section-number">14</span> GLM Poisson</a></div>
<div class="next"><a href="glmsuperv.html"><span class="header-section-number">16</span> GLM para datos de supervivencia</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#glmtablascont"><span class="header-section-number">15</span> GLM para tablas de contingencia</a></li>
<li>
<a class="nav-link" href="#bancos-de-datos-6"><span class="header-section-number">15.1</span> Bancos de datos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#melanoma"><span class="header-section-number">15.1.1</span> Melanoma</a></li>
<li><a class="nav-link" href="#gripe"><span class="header-section-number">15.1.2</span> Gripe</a></li>
<li><a class="nav-link" href="#aspirina"><span class="header-section-number">15.1.3</span> Aspirina</a></li>
<li><a class="nav-link" href="#aspiraciones"><span class="header-section-number">15.1.4</span> Aspiraciones</a></li>
<li><a class="nav-link" href="#contraceptivos"><span class="header-section-number">15.1.5</span> Contraceptivos</a></li>
<li><a class="nav-link" href="#satisfacci%C3%B3n-laboral"><span class="header-section-number">15.1.6</span> Satisfacción laboral</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#modelos-log-lineales"><span class="header-section-number">15.2</span> Modelos Log-Lineales</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#especificaci%C3%B3n-en-r"><span class="header-section-number">15.2.1</span> Especificación en R</a></li>
<li><a class="nav-link" href="#ejemplos-21"><span class="header-section-number">15.2.2</span> Ejemplos</a></li>
</ul>
</li>
<li><a class="nav-link" href="#modelos-logit-multinomial"><span class="header-section-number">15.3</span> Modelos Logit-Multinomial</a></li>
<li>
<a class="nav-link" href="#estimaci%C3%B3n"><span class="header-section-number">15.4</span> Estimación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#respuesta-binaria-nominal-y-predictora-nominal"><span class="header-section-number">15.4.1</span> Respuesta binaria nominal y predictora nominal</a></li>
<li><a class="nav-link" href="#respuesta-multinomial-nominal-y-predictora-nominal"><span class="header-section-number">15.4.2</span> Respuesta multinomial nominal y predictora nominal</a></li>
<li><a class="nav-link" href="#respuesta-nominal-predictora-ordinal"><span class="header-section-number">15.4.3</span> Respuesta nominal, predictora ordinal</a></li>
<li><a class="nav-link" href="#respuesta-ordinal-predictora-nominal"><span class="header-section-number">15.4.4</span> Respuesta ordinal, predictora nominal</a></li>
<li><a class="nav-link" href="#respuesta-ordinal-predictora-ordinal"><span class="header-section-number">15.4.5</span> Respuesta ordinal, predictora ordinal</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#diagn%C3%B3stico-6"><span class="header-section-number">15.5</span> Diagnóstico</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#ejemplos-22"><span class="header-section-number">15.5.1</span> Ejemplos</a></li></ul>
</li>
<li><a class="nav-link" href="#predicci%C3%B3n-6"><span class="header-section-number">15.6</span> Predicción</a></li>
<li><a class="nav-link" href="#ejercicios-5"><span class="header-section-number">15.7</span> Ejercicios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Modelos Estadísticos</strong>" was written by true, true. It was last built on 2022-03-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
